# アクションプラン（改修作業計画）

## 1. はじめに

このドキュメントは、「フロントエンド・バックエンド精査資料（更新版）」で特定された課題に基づき、今後の開発作業を計画し、優先順位を明確にすることを目的とします。

各タスクはチェックボックス形式で管理し、完了次第チェックを入れて進捗を追跡します。

## 2. 優先タスク (Phase 1: 安定化とクリーンアップ)

アプリケーションの安定性と信頼性を確保するため、以下のタスクに最優先で取り組みます。

### フロントエンド Phase 1

- [x] **タスク1: イベントリスナーのメモリリーク修正**
  - **内容**: `render`関数内で繰り返し呼び出される `setupAccountingFormListeners`
    の問題を解決する。イベントリスナーの登録・解除をビューのライフサイクル（表示/非表示）に連動させる。
  - **目的**: アプリケーションのパフォーマンス低下とメモリリークを根本的に解決する。
  - **関連ファイル**: `14_WebApp_Handlers.html`, `12_WebApp_Core.html`

- [ ] **タスク2: 状態管理の完全移行**
  - **内容**:
    - [ ] `setState()` の使用箇所を `stateManager.dispatch()` に置き換える。
    - [ ] `appState` への直接参照を `stateManager.getState()` 経由に置き換える。
    - [ ] グローバルな `appState` と `setState` を完全に削除する。
  - **目的**: 厳密な単一方向データフローを確立し、コードの予測可能性と保守性を向上させる。
  - **関連ファイル**: `12_WebApp_Core.html`, `13_WebApp_Views.html`, `14_WebApp_Handlers.html`

### バックエンド Phase 1

- [ ] **タスク3: 不要コードの削除 (デッドコードのクリーンアップ)**
  - **内容**: データモデル刷新に伴い不要となった旧データモデル（教室別シート、予約サマリーシート等）を参照するコードを完全に削除する。
  - **目的**: コードベースの複雑性を低減し、新規開発者の混乱を防ぐ。
  - **関連ファイル**: `02-*_BusinessLogic_*.js`, `05-*_Backend_*.js`
    など旧モデルを参照している可能性のあるファイル群

- [ ] **タスク4: トランザクション管理の強化**
  - **内容**: `LockService`の利用をカプセル化したユーティリティ関数を導入し、複数リソース（シート、キャッシュ）の更新処理をアトミックに実行するパターンを徹底する。
  - **目的**: データの不整合や競合状態のリスクを最小化し、システムの信頼性を高める。
  - **関連ファイル**: `05-2_Backend_Write.js`, `08_Utilities.js` (新規ヘルパー関数)

## 3. 中期タスク (Phase 2: 開発体験と保守性の向上)

Phase 1完了後、開発効率とコード品質をさらに高めるためのタスクです。

### フロントエンド Phase 2

- [ ] **タスク5: HTML生成方法の見直し**
  - **内容**: 現在のテンプレートリテラルによる文字列結合から、`lit-html` や `preact`
    などの軽量ライブラリ導入を検討・実装する。
  - **目的**: UIコードの可読性、保守性、パフォーマンスを向上させる。
  - **関連ファイル**: `12_WebApp_Core.html`, `13_WebApp_Views.html`

- [ ] **タスク6: TypeScript導入準備 (JSDoc拡充)**
  - **内容**: 主要な関数、データ構造（特に `appState`
    やAPIレスポンス）に対して、型情報を記述したJSDocコメントを充実させる。
  - **目的**: 型安全性を高め、将来的なTypeScriptへのスムーズな移行を準備する。
  - **関連ファイル**: プロジェクト全体

### バックエンド & 共通  Phase 2

- [ ] **タスク7: テスト環境の拡充**
  - **内容**: 主要なビジネスロジック（料金計算、空き枠計算、データ更新処理など）に対するユニットテストを整備する。
  - **目的**: リファクタリングや機能追加時のデグレードを防止し、コードの品質を担保する。
  - **関連ファイル**: `tools/` ディレクトリ、`test/` ディレクトリ

- [ ] **タスク8: ファイル命名規則の統一**
  - **内容**: `05-1_Backend_Read.js` と `07_CacheManager.js`
    のような不統一なファイル名を、プロジェクト全体で一貫したルール（例:
    `xx_Scope_Name.js`）に統一する。
  - **目的**: プロジェクト構造の把握を容易にする。
  - **関連ファイル**: `src/` ディレクトリ内の多数のファイル

## 4. タスク管理

- 各タスクは、このドキュメントのチェックボックスで進捗を管理します。
- より詳細な議論や作業ログが必要な場合は、GitHub Issuesの活用を推奨します。
