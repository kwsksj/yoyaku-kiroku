# 作業計画書（具体化版）: FE-13 会計フローの再設計

## 1. 目的

- ユーザー（生徒）が誤って会計処理を完了させてしまう事故を防ぐ。
- 先生とのコミュニケーションを促進し、会計処理の信頼性・体験を向上させる。

## 2. 対象タスク

- 会計画面のUI変更
- 確認モーダルの実装
- 支払い処理のフロー変更
- 完了画面への遷移

## 3. 影響範囲

- `13_WebApp_Views.html`（会計画面UI）
- `14_WebApp_Handlers.html`（アクションハンドラ）
- `12_WebApp_Core.html`（モーダル表示機能）

## 4. 実装詳細

### 4.1 会計画面UIの変更

- `getAccountingView`関数内
  - 支払い方法詳細（ラジオボタン・説明等）は初期画面から削除。
  - 合計金額コピーボタンも削除
  - 合計金額表示の直下に「金額を、先生に確認してもらってください」という注意テキストを追加。
  - その下に「先生の確認完了」ボタン（`data-action="showAccountingConfirmation"`）を追加。
  - ボタン押下で支払いモーダルを表示する。

### 4.2 支払いモーダルの実装

- `showAccountingConfirmation`アクションハンドラを新規実装（`14_WebApp_Handlers.html`）。
  - `calculateAccountingDetails()`で会計情報を取得。
  - モーダル内容：
    - 合計金額（コピーボタン付き）
    - 支払い方法詳細（ラジオボタン＋説明）
    - 「この内容で支払いました」ボタン
    - 赤字テキスト「必ずボタンを押してね」

### 4.3 支払い処理の変更

- モーダルの「この内容で支払いました」ボタン押下時、`confirmAndPay`アクションハンドラを呼び出す。
- `confirmAndPay`では再度`calculateAccountingDetails()`で会計情報を取得し、`saveAccountingDetails`を呼び出す。
- 保存成功時は`setState`で`complete`ビューへ遷移。

### 4.4 完了画面への遷移

- 完了画面（`getCompleteView`）で「会計情報を記録しました。続けて次の予約をされますか？」等のメッセージを表示。
- 「同じ教室の予約へ」ボタン（`data-action="goToBooking"`）を設置。

## 5. 受け入れ基準

- [ ] 会計画面に「先生の確認完了」ボタンが表示される。
- [ ] ボタン押下で支払いモーダルが表示される。
- [ ] モーダルに合計金額・支払い方法・「この内容で支払いました」ボタン・注意テキストが表示される。
- [ ] 「この内容で支払いました」ボタン押下で会計情報が保存され、完了画面に遷移する。
- [ ] 完了画面に次の予約を促すメッセージとボタンが表示される。

## 6. 備考・注意点

- 既存の`showConfirm`/`showModal`の仕様に合わせて実装すること。
- 画面遷移・状態管理は`setState`で一貫して行うこと。
- 既存の会計保存ロジック（`saveAccountingDetails`）は流用する。

---
