/**
 * =================================================================
 * ãƒ•ã‚¡ã‚¤ãƒ«æ¦‚è¦
 * -----------------------------------------------------------------
 * åç§°: 12_WebApp_Core.js
 * ç›®çš„: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸­æ ¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨åˆ†å‰²ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ¥ç€é¢ã‚’æä¾›ã™ã‚‹
 * ä¸»ãªè²¬å‹™:
 *   - åˆ†å‰²æ¸ˆã¿ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¬ã‚¤ãƒ‰ãŠã‚ˆã³ä¸€éƒ¨ãƒ¬ã‚¬ã‚·ãƒ¼é–¢æ•°ã®ä¿æŒ
 *   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã©å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å…¬é–‹
 *   - ä¼šè¨ˆå‡¦ç†ãªã©ä»–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸å§”è­²ã™ã‚‹éš›ã®æœ€çµ‚ãƒ•ãƒƒã‚¯
 * AIå‘ã‘ãƒ¡ãƒ¢:
 *   - æ–°ã—ã„ã‚³ã‚¢æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã¨ãã¯ã€ã¾ãšå°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã‚¬ã‚¤ãƒ‰ã¨æœ€å°é™ã®æ¥ç€ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ã‚’æ®‹ã™
 * =================================================================
 */

// ================================================================
// ãƒãƒ³ãƒ‰ãƒ©ç³»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
// ================================================================
import { updateAccountingCalculation } from './12-3_Accounting_Handlers.js';

// =================================================================
// --- Divided Core Files Reference ---
// -----------------------------------------------------------------
// ä»¥ä¸‹ã®æ©Ÿèƒ½ã¯å°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã•ã‚Œã¾ã—ãŸï¼š
//
// ğŸ“ 12_WebApp_Core_Search.js - çµ±ä¸€æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ 
// ğŸ“ 12_WebApp_Core_Data.js - ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ»ç’°å¢ƒç®¡ç†
// ğŸ“ 12_WebApp_Core_Modal.js - ãƒ¢ãƒ¼ãƒ€ãƒ«ç®¡ç†
// ğŸ“ 12_WebApp_Core_Accounting.js - ä¼šè¨ˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
// ğŸ“ 12_WebApp_Core_ErrorHandler.js - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
//
// ğŸ“ 14_WebApp_Handlers_Utils.js - çµ±åˆæ¸ˆã¿ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// =================================================================

// =================================================================
// --- Loading Message System ---
// -----------------------------------------------------------------
// UI-11: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¤šæ§˜åŒ–æ©Ÿèƒ½
// çŠ¶æ³ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¡¨ç¤ºã—ã€
// æ•°ç§’ã”ã¨ã«è‡ªå‹•ã§åˆ‡ã‚Šæ›¿ãˆã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
// =================================================================

/** @type {ReturnType<typeof setInterval> | null} */
export let loadingMessageTimer = null;

export const LoadingMessages = {
  // ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  login: [
    'ã‚ã„ã¼ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã‚ã„ã¼ ã˜ãŸã„ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã‚ã„ã¼ ã® ã†ã‚‰ã® ã‚ã‚‚ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ãã‚ã ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã—ã‚‡ã‚‹ã„ ã‚’ ã²ã‚‚ã¨ã„ã¦ã„ã¾ã™...',
    'ãªã¾ãˆ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ãªã¾ãˆ ã® ã‚ˆã¿ã‹ãŸ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã‹ãŠ ã‚’ ãŠã‚‚ã„ã ã—ã¦ã„ã¾ã™...',
    'ãŠã¿ã‚„ã’ ã‚’ ãŠã‚‚ã„ã ã—ã¦ã„ã¾ã™...',
    'ã•ãã²ã‚“ ã‚’ ãŠã‚‚ã„ã ã—ã¦ã„ã¾ã™...',
    'ã¨ã†ã‚ã ãŒ ã‚ã‚‹ã‹ ã—ã‚‰ã¹ã¦ã„ã¾ã™...',
    'ã§ã‚“ã‚ã°ã‚“ã”ã† ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã²ã¨ ã¨ ãªã‚Š ã‚’ ãã†ãã† ã—ã¦ã„ã¾ã™...',
    'ã«ãŒãŠ ãˆ ã‚’ ã‹ã„ã¦ã„ã¾ã™...',
    'ã‚ã„ã“ã¨ã° ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã¨ã³ã‚‰ ã® ã‹ã ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã¸ã‚„ ã® ã§ã‚“ã ã‚’ ã¤ã‘ã¦ã„ã¾ã™...',
    'ãŠã¡ã‚ƒ ã® ã˜ã‚…ã‚“ã³ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ãã‚‡ã† ã® ã‚ˆã¦ã„ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã‚ãŒã­ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã§ã‚€ã‹ãˆ ã® ã˜ã‚…ã‚“ã³ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã™ã‚Šã£ã± ã‚’ ãªã‚‰ã¹ã¦ã„ã¾ã™...',
    'ãŠã¸ã‚„ ã® ãã†ã˜ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã¯ã˜ã‚ã¾ã—ã¦ ã® ã‚ã„ã•ã¤ ã‚’ ã‚Œã‚“ã—ã‚…ã†ã—ã¦ã„ã¾ã™...',
    'ãã‚“ã¡ã‚‡ã† ã‚’ ã»ãã—ã¦ã„ã¾ã™...',
    'ãˆãŒãŠ ã‚’ ã¤ãã£ã¦ã„ã¾ã™...',
    'ã‚ãã—ã‚… ã® ã‚Œã‚“ã—ã‚…ã† ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã«ã‚“ã—ã‚‡ã† ã¡ã‚…ã† ã§ã™...',
    'ã»ã‚“ã«ã‚“ ã‹ãã«ã‚“ ã¡ã‚…ã† ã§ã™...',
  ],

  // ç”³ã—è¾¼ã¿æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  booking: [
    'ã‚ˆã‚„ã ã‚’ ã‚‚ã†ã—ã“ã¿ ã¡ã‚…ã†ã§ã™...',
    'ã—ã‚“ã›ã„ã—ã‚‡ ã‚’ ã¦ã„ã—ã‚…ã¤ ã—ã¦ã„ã¾ã™...',
    'ã¯ã‚“ã“ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã²ã¥ã‘ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã‹ã‚Œã‚“ã ãƒ¼ ã« ã‹ãã“ã‚“ã§ã„ã¾ã™...',
    'ã›ã ã‚’ ã‚ˆã†ã„ ã—ã¦ã„ã¾ã™...',
    'ãã¼ã† ã‚’ ã‹ãªãˆã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
    'ã„ã‚ã„ã‚ãª ã¡ã‚‡ã†ã›ã„ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ãã†ã”ã†ã¦ãã« ã¡ã‚‡ã†ã›ã„ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã—ã‚‡ã‚‹ã„ ã® ã‘ã„ã—ã ã‚’ ã‹ãã«ã‚“ã—ã¦ã„ã¾ã™...',
    'ã˜ã‚…ã‚“ã°ã‚“ ã« ãªã‚‰ã¹ã¦ã„ã¾ã™...',
    'ã†ã‘ã¤ã‘ ã® ã²ã¨ ã‚’ ã‚ˆã‚“ã§ã„ã¾ã™...',
    'ã‚ã„ã¦ã„ã‚‹ ã² ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã™ã‘ã˜ã‚…ãƒ¼ã‚‹ ã‚’ ã¡ã‚‡ã†ã›ã„ ã—ã¦ã„ã¾ã™...',
    'ã‚ˆã‚„ãã²ã‚‡ã† ã« ã—ã‚‹ã—ã‚’ã¤ã‘ã¦ã„ã¾ã™...',
    'ã–ã„ã‚Šã‚‡ã† ã‚’ ã˜ã‚…ã‚“ã³ ã—ã¦ã„ã¾ã™...',
    'ã©ã†ã ã‚’ ãã‚ãˆã¦ã„ã¾ã™...',
    'ã‚ãã‚ã ã‚’ ã˜ã‚…ã‚“ã³ ã—ã¦ã„ã¾ã™...',
    'ã†ãã†ã ã‚’ ãŠã•ãˆã¦ ã„ã¾ã™...',
    'ã¾ã¡ã©ãŠã—ã„ ãã‚‚ã¡ ã‚’ ã‹ã‚“ã˜ã¦ã„ã¾ã™...',
    'ã™ãŸã‚“ã· ã‚’ ãŠã—ã¦ã„ã¾ã™...',
    'ã†ã‘ã¤ã‘ã°ã‚“ã”ã† ã‚’ ã¯ã£ã“ã†ã—ã¦ã„ã¾ã™...',
    'ã‹ãã«ã‚“ã‚ãƒ¼ã‚‹ ã‚’ ã˜ã‚…ã‚“ã³ ã—ã¦ã„ã¾ã™...',
    'ã•ã‚“ã‹ã—ã‚ƒ ã‚ã„ã¼ ã« ã¤ã„ã‹ã—ã¦ã„ã¾ã™...',
    'ã‚ãƒ¼ã‚‹ã‚ã©ã‚Œã™ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
  ],

  // ã‚ˆã‚„ãã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  cancel: [
    'ã‚ˆã‚„ã ã‚’ ã¨ã‚Šã‘ã—ã¦ã„ã¾ã™...',
    'ã‘ã—ã”ã‚€ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã¨ã‚Šã‘ã—ã›ã‚“ ã‚’ ã²ã„ã¦ã„ã¾ã™...',
    'ãŠã ã„ã˜ã« ã¨ ãŠã‚‚ã£ã¦ã„ã¾ã™...',
    'ã¾ãŸ ã“ã‚“ã© ã‚’ ãŸã®ã—ã¿ã«ã—ã¦ã„ã¾ã™...',
    'ã¹ã¤ã® ã² ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã‹ã‚Œã‚“ã ãƒ¼ ã® ã‚ˆã¦ã„ ã‚’ ã‘ã—ã¦ã„ã¾ã™...',
    'ã–ã‚“ã­ã‚“ ãª ãã‚‚ã¡ ã‚’ ãŠã•ãˆã¦ã„ã¾ã™...',
    'ã¤ã ã® ãã‹ã„ ã‚’ ã¾ã£ã¦ã„ã¾ã™...',
    'ã•ã³ã—ã„ ãã‚‚ã¡ ã‚’ ã‹ãã—ã¦ã„ã¾ã™...',
    'ã’ã‚“ãã§ ã¨ ã­ãŒã£ã¦ã„ã¾ã™...',
    'ã˜ã‹ã„ã‚ˆã‚„ã ã‚’ ãŠã¾ã¡ã—ã¦ã„ã¾ã™...',
    'ãªã¿ã  ã‚’ ã“ã‚‰ãˆã¦ã„ã¾ã™...',
    'ãã£ã¨ ã“ã‚‰ãˆã¦ã„ã¾ã™...',
    'ã¾ãŸ ã‚ãˆã‚‹ ã² ã‚’ ã—ã‚“ã˜ã¦ã„ã¾ã™...',
    'ã¯ã’ã¾ã— ã® ã“ã¨ã° ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã‚ã„ãŸ ã˜ã‹ã‚“ ã« ãªã« ã‚’ ã—ã‚ˆã†ã‹ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
  ],

  // ã‚ˆã‚„ãç·¨é›†æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  edit: [
    'ã¸ã‚“ã“ã† ã‚’ ã»ãã‚“ã—ã¦ã„ã¾ã™...',
    'ã‚ãŸã‚‰ã—ã„ ãªã„ã‚ˆã† ã« ã‹ãã‹ãˆã¦ã„ã¾ã™...',
    'ã¾ã¡ãŒã„ ãŒ ãªã„ã‹ ã‹ãã«ã‚“ã—ã¦ã„ã¾ã™...',
    'ã‹ã‚“ãŒãˆãªãŠã—ã¦ ã¿ã¦ã„ã¾ã™...',
    'ã“ã ã‚ã‚Š ã‚’ ã¡ã‚‡ã†ã›ã„ ã—ã¦ã„ã¾ã™...',
    'ãˆã‚“ã´ã¤ ã‚’ ã‘ãšã£ã¦ã„ã¾ã™...',
    'ã‚ˆã‚Š ã‚ˆã„ ãªã„ã‚ˆã† ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã‹ã‚ã£ãŸ ã¨ã“ã‚ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã“ã‚Œã§ ã‚ˆã„ã‹ ãªã‚„ã‚“ã§ã„ã¾ã™...',
    'ã•ã„ã—ã‚…ã†ã¡ã‡ã£ã ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã—ã‚…ã†ã›ã„ãˆã ã‚’ ã¤ã‹ã£ã¦ã„ã¾ã™...',
    'ã‹ããªãŠã—ã¦ ã„ã¾ã™...',
    'ã¹ã¤ã® ã²ã‚‡ã†ã’ã‚“ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã„ã„ã¾ã‚ã— ã‚’ ã¡ã‚‡ã†ã›ã„ ã—ã¦ã„ã¾ã™...',
    'ã«ã‚…ã‚ã‚“ã™ ã‚’ ã¨ã¨ã®ãˆã¦ã„ã¾ã™...',
    'ã´ã£ãŸã‚Š ã® ã“ã¨ã° ã‚’ ãˆã‚‰ã‚“ã§ã„ã¾ã™...',
    'ãã‚‚ã¡ ã‚’ ã“ã‚ã¦ã„ã¾ã™...',
    'ã•ã„ã” ã® ã¿ãŒã ã‚’ ã‹ã‘ã¦ã„ã¾ã™...',
    'ã³ã¿ã‚‡ã† ãª ã¡ãŒã„ ã‚’ ã¡ã‚‡ã†ã›ã„ ã—ã¦ã„ã¾ã™...',
    'ã°ã‚‰ã‚“ã™ ã‚’ ã¨ã£ã¦ã„ã¾ã™...',
    'ã¾ã‚‹ ã‚’ ã¤ã‘ã¦ã„ã¾ã™...',
    'ã‹ã„ãã‚‡ã† ã‚’ ã¡ã‚‡ã†ã›ã„ ã—ã¦ã„ã¾ã™...',
    'ã¿ãŸã‚ ã‚’ ã¨ã¨ã®ãˆã¦ã„ã¾ã™...',
    'ã¸ã‚“ã“ã†ã‚Šã‚Œã ã‚’ ãã‚ã ã—ã¦ã„ã¾ã™...',
    'ã°ã£ãã‚ã£ã· ã‚’ ã¨ã£ã¦ã„ã¾ã™...',
  ],

  // ä¼šè¨ˆæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  accounting: [
    'ã§ã‚“ã´ã‚‡ã† ã‚’ ãŠãã£ã¦ã„ã¾ã™...',
    'ã¡ã‚‡ã†ã¼ ã‚’ ã¤ã‘ã¦ã„ã¾ã™...',
    'ãŠã‹ã­ ã‚’ ã‹ããˆã¦ã„ã¾ã™...',
    'ãŠã¤ã‚Š ã‚’ ã˜ã‚…ã‚“ã³ã—ã¦ã„ã¾ã™...',
    'ãã‚ã°ã‚“ ã‚’ ã¯ã˜ã„ã¦ã„ã¾ã™...',
    'ã‘ã„ã•ã‚“ã ã‚’ ãŸãŸã„ã¦ã„ã¾ã™...',
    'ã½ã‘ã£ã¨ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã‘ã„ã‚Šã®ã²ã¨ ã‚’ ã‚ˆã‚“ã§ã„ã¾ã™...',
    'ãµã†ã¨ã† ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã‚Šã‚‡ã†ã—ã‚…ã†ã—ã‚‡ ã‚’ ã‚ˆã†ã„ã—ã¦ã„ã¾ã™...',
    'ãŠã‹ã­ ã® ã‹ã‚“ã˜ã‚‡ã† ãŒ ã‚ã†ã‹ ã‹ãã«ã‚“ã—ã¦ã„ã¾ã™...',
    'ãŠã‹ã­ ã® ã‹ã‚“ã˜ã‚‡ã† ãŒ ã‚ã†ã‹ ã‹ãã«ã‚“ã—ã¦ã„ã¾ã™...',
    'ãŠã•ã¤ ã‚’ ãã‚Œã„ ã« ãã‚ãˆã¦ã„ã¾ã™...',
    'ã‚Œã˜ ã® ã˜ã‚…ã‚“ã³ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã•ã¤ãŸã° ã® ãŠãµã‚ ã‚’ ã˜ã‚…ã‚“ã³ã—ã¦ã„ã¾ã™...',
    'ãã‚“ã“ ã® ã‹ã ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã¯ã‚“ã“ ã‚’ ãŠã—ã¦ã„ã¾ã™...',
    'ã“ã´ãƒ¼ ã‚’ ã¨ã£ã¦ã„ã¾ã™...',
    'ãµãã„ã‚‹ ã« ã¨ã˜ã¦ã„ã¾ã™...',
    'ã»ã‹ã‚“ ã°ã—ã‚‡ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã§ãƒ¼ãŸã¹ãƒ¼ã™ ã« ã¨ã†ã‚ã ã—ã¦ã„ã¾ã™...',
    'ã†ã‚Šã‚ã’ ã‚’ ã—ã‚…ã†ã‘ã„ ã—ã¦ã„ã¾ã™...',
    'ã™ã·ã‚Œã£ã©ã—ãƒ¼ã¨ ã« ãã«ã‚…ã† ã—ã¦ã„ã¾ã™...',
  ],

  // ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  dataFetch: [
    'ã„ã‚ã„ã‚ãªã‚‚ã® ã‚’ ã²ã£ãã‚Šã‹ãˆã—ã¦ã„ã¾ã™...',
    'ã•ãŒã—ã‚‚ã® ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ãŸã„ã›ã¤ãªã“ã¨ ã‚’ ãŠã‚‚ã„ã ã—ã¦ã„ã¾ã™...',
    'ã‚€ã“ã†ã®ã»ã† ã‚’ ã®ãã„ã¦ã„ã¾ã™...',
    'ã˜ã‚‡ã†ã»ã† ã‚’ ã¤ã‹ã¾ãˆã¦ã„ã¾ã™...',
    'ã—ã‚‡ã‚‹ã„ ã‚’ ã²ã£ãã‚Šã‹ãˆã—ã¦ã„ã¾ã™...',
    'ãƒ‡ãƒ¼ã‚¿ã® ã†ã¿ ã« ã‚‚ãã£ã¦ã„ã¾ã™...',
    'ããŠã ã® ãã“ ã‚’ ã•ãã£ã¦ã„ã¾ã™...',
    'ã¡ãš ã‚’ ã²ã‚ã’ã¦ã„ã¾ã™...',
    'ã‚€ã‹ã— ã® ãã‚ã ã‚’ ã‚ˆã¿ã‹ãˆã—ã¦ã„ã¾ã™...',
    'ãµã‚‹ã„ ã»ã‚“ ã‚’ ã‚ãã£ã¦ã„ã¾ã™...',
    'ãºãƒ¼ã˜ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã‚‚ãã˜ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã„ã‚“ã§ã£ãã™ ã‚’ ãŸã©ã£ã¦ã„ã¾ã™...',
    'ã¶ã£ãã¾ãƒ¼ã ã‚’ ã¿ã¤ã‘ã¦ã„ã¾ã™...',
    'ã—ãŠã‚Š ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã‘ã‚“ã•ã ã¡ã‚…ã† ã§ã™...',
    'ã˜ã‚…ã‚“ã°ã‚“ ã‚’ ãªã‚‰ã³ã‹ãˆã¦ã„ã¾ã™...',
    'ãã‚‹ãƒ¼ã·ã‚ã‘ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã—ã‚…ã†ã‘ã„ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã¨ã†ã‘ã„ ã‚’ ã¨ã£ã¦ã„ã¾ã™...',
    'ã¶ã‚“ã›ã ã‚’ ã—ã¦ã„ã¾ã™...',
    'ãã‚‰ãµ ã‚’ ã‹ã„ã¦ã„ã¾ã™...',
    'ã²ã‚‡ã† ã‚’ ã¤ãã£ã¦ã„ã¾ã™...',
    'ã‚Œã½ãƒ¼ã¨ ã‚’ ã•ãã›ã„ ã—ã¦ã„ã¾ã™...',
    'ã•ãƒ¼ã°ãƒ¼ ã¨ ã¤ã†ã—ã‚“ ã—ã¦ã„ã¾ã™...',
  ],

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  default: [
    'ã›ã‚“ã›ã„ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã—ã‚‡ã‚‹ã„ ã‚’ ã›ã„ã‚Š ã—ã¦ã„ã¾ã™...',
    'ã—ã‚‡ã‚‹ã„ ã‚’ ãªãŒã‚ã¦ã„ã¾ã™...',
    'ã—ã‚‡ã‚‹ã„ ã® ã‘ã„ã—ã ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã—ã‚‡ã‚‹ã„ ã‚’ ã¶ã‚“ã‚‹ã„ ã—ã¦ã„ã¾ã™...',
    'ãããš ã‚’ ã‹ãŸãšã‘ã¦ã„ã¾ã™...',
    'ã“ã¨ã° ã‚’ ãˆã‚‰ã‚“ã§ã„ã¾ã™...',
    'ã¦ã„ã•ã„ ã‚’ ã¨ã¨ã®ãˆã¦ã„ã¾ã™...',
    'ã¿ã ã® ã‚‚ã® ã‚’ ã²ã ã‚Š ã« ã†ã”ã‹ã—ã¦ã„ã¾ã™...',
    'ã²ã ã‚Š ã® ã‚‚ã® ã‚’ ã¿ã ã« ã†ã”ã‹ã—ã¦ã„ã¾ã™...',
    'ã“ãƒ¼ã²ãƒ¼ ã‚’ ã„ã‚Œã¦ã„ã¾ã™...',
    'ã™ã“ã— ãã‚…ã†ã‘ã„ ã—ã¦ã„ã¾ã™...',
    'ã­ã“ ã® ã¦ ã‚’ ã‹ã‚Šã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
    'ã¯ã‚€ã™ãŸãƒ¼ ã® ã¦ ã‚’ ã‹ã‚Šã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
    'ãã† ã® ã¯ãª ã‚’ ã‹ã‚Šã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
    'ã‚ã ã‹ ã‚’ ãªãŒã‚ã¦ã„ã¾ã™...',
    'ã‚ã ã‹ ã‚’ ã‹ããˆã¦ã„ã¾ã™...',
    'ã¯ã‚‚ã® ã‚’ ã¨ã¨ã®ãˆã¦ã„ã¾ã™...',
    'ã¦ã‚“ ã¨ ã¦ã‚“ ã‚’ ã‚€ã™ã‚“ã§ã„ã¾ã™...',
    'ã‚ãŸã¾ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã›ã‚“ã›ã„ ã¯ ã—ã‚…ã†ã¡ã‚…ã† ã—ã¦ã„ã¾ã™...',
    'ã›ã‚“ã›ã„ ã¯ ã„ã¾ ã‚€ã‹ã£ã¦ã„ã¾ã™...',
    'ã‚ã·ã‚Š ã‚’ ã‹ã„ã‚Šã‚‡ã† ã—ã¦ã„ã¾ã™...',
    'ãœã‚“ãŸã„ ã¨ ã¶ã¶ã‚“ ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã‚„ã‚‰ãªã„ã¨ã„ã‘ãªã„ã“ã¨ ã‚’ ãªãŒã‚ã¦ã„ã¾ã™...',
    'ã‚ãŸã‚‰ã—ã„ ã“ã¨ ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã§ãã‚ãŒã‚Š ã‚’ ãŠã‚‚ã„ãˆãŒã„ã¦ã„ã¾ã™...',
    'ã¤ããˆ ã® ã†ãˆ ã§ ã—ã”ã¨ã‚‰ã—ãã“ã¨ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã¾ã‚‹ã„ ã‚‚ã® ã‚’ ã—ã‹ãã ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
    'ã—ã‹ãã„ ã‚‚ã® ã‚’ ã¾ã‚‹ã ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
    'ã—ã‹ãã„ ã‚‚ã® ã‚’ ã‚ˆã‚Šã—ã‹ãã ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
    'ãŠã‚‚ã—ã‚ã„ ã‹ãŸã¡ ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã˜ã‹ã‚“ ãŒ ã‚†ã£ãã‚Š ã™ãã¦ã„ã¾ã™...',
    'ã˜ã‹ã‚“ ãŒ ã‚ã£ã¨ã„ã†ã¾ã« ã™ãã¦ã„ã¾ã™...',
    'ã„ã„ ã‹ãŸã¡ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ãã‚Œã‚‰ã—ã„ ã“ã¨ã° ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ãªã«ã‚’ã—ã‚ˆã†ã¨ã—ã¦ã„ãŸã®ã‹ ã‚’ ãŠã‚‚ã„ã ã—ã¦ã„ã¾ã™...',
    'ã‹ãŸã¡ ã‚’ ãªãŒã‚ã¦ã„ã¾ã™...',
    'ãŠã‹ã— ã‚’ ãŸã¹ã¦ã„ã¾ã™...',
    'ã¤ã ã® ã•ãã‚‡ã† ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã‚ãŸã¾ ã‚’ ã²ã­ã£ã¦ã„ã¾ã™...',
    'ã²ã‚‰ã‚ã ã‚’ ã¾ã£ã¦ã„ã¾ã™...',
    'ãˆã‚“ã´ã¤ ã‚’ ã¨ãŒã‚‰ã›ã¦ã„ã¾ã™...',
    'ã•ãã²ã‚“ ã‚’ ãªãŒã‚ã¦ã„ã¾ã™...',
    'ã¾ã© ã® ãã¨ ã‚’ ãªãŒã‚ã¦ã„ã¾ã™...',
    'ãã‚‚ ã® ã‹ãŸã¡ ã‚’ ã‹ã‚“ã•ã¤ ã—ã¦ã„ã¾ã™...',
    'ã¨ã‚Š ã® ãªãã”ãˆ ã« ã¿ã¿ ã‚’ ã™ã¾ã—ã¦ã„ã¾ã™...',
    'ãŠã‚“ãŒã ã‚’ ãã„ã¦ã„ã¾ã™...',
    'ã¯ãªã†ãŸ ã‚’ ã†ãŸã£ã¦ã„ã¾ã™...',
    'ã‚ã—ãŸ ã® ã¦ã‚“ã ã‚’ ã—ã‚‰ã¹ã¦ã„ã¾ã™...',
    'ã—ã‚“ã“ãã‚…ã† ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã™ã¨ã‚Œã£ã¡ ã‚’ ã—ã¦ã„ã¾ã™...',
    'ã†ã¡ã‚…ã† ã® ãªã ã« ãŠã‚‚ã„ ã‚’ ã¯ã›ã¦ã„ã¾ã™...',
    'ã˜ã¶ã‚“ ã® ãã‚“ã–ã„ ã‚’ ã¨ã†ã¦ã„ã¾ã™...',
    'ã‹ãŸã¡ ã‚’ ã‹ã‚“ãŒãˆã¦ã„ã¾ã™...',
    'ã‹ãŸã¡ ã‚’ ã¤ã‚ã¦ã„ã¾ã™...',
    'ã„ã„ ã‹ãŸã¡ ã‚’ ã•ãŒã—ã¦ã„ã¾ã™...',
    'ã­ã“ ã® ã—ã‚‡ãã˜ ã‚’ ãªãŒã‚ã¦ã„ã¾ã™...',
    'ã‹ã‚‰ã  ã‚’ ã®ã°ã—ã¦ã„ã¾ã™...',
    'ã¡ã‚ƒã„ ã‚’ ã„ã‚Œã¦ã„ã¾ã™...',
    'ã¡ã‚‡ã†ã“ãã¨ã† ã‚’ ã¨ã ãŠã¨ ãŒ ãã“ãˆã¦ã„ã¾ã™...',
    'ã‚‚ãã‚ ã‚’ ã‹ãã«ã‚“ ã—ã¦ã„ã¾ã™...',
    'ã–ã„ã‚Šã‚‡ã† ã‚’ ãˆã‚‰ã‚“ã§ã„ã¾ã™...',
    'ã‹ãŸã• ã‚’ ãŸã‚ã—ã¦ã„ã¾ã™...',
    'ã—ãœã‚“ ã‚’ ã‹ã‚“ã˜ã¦ã„ã¾ã™...',
    'ã‚€ã˜ã‚ƒã ãª ã“ã“ã‚ ã‚’ ã¨ã‚Šã‚‚ã©ã—ã¦ã„ã¾ã™...',
    'ã¯ã˜ã‚ã¦ ã® ãã‚‚ã¡ ã‚’ ãŠã‚‚ã„ã ã—ã¦ã„ã¾ã™...',
    'ã•ã„ã—ã‚‡ ã® ã„ã£ã½ ã‚’ ãŠã‚‚ã„ã ã—ã¦ã„ã¾ã™...',
    'ã‚ã‚†ã¿ ã‚’ ãµã‚Šã‹ãˆã£ã¦ã„ã¾ã™...',
    'ã›ã„ã¡ã‚‡ã† ã‚’ ã‹ã‚“ã˜ã¦ã„ã¾ã™...',
    'ã¸ã‚“ã‹ ã‚’ ãŸã®ã—ã‚“ã§ã„ã¾ã™...',
    'ã—ã‚“ã‹ ã‚’ ã¤ã¥ã‘ã¦ã„ã¾ã™...',
    'ã¿ã¡ ã‚’ ãã‚ã‚ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...',
  ],
};

export const getRandomMessage = (category = 'default') => {
  const loadingMessages = /** @type {Record<string, string[]>} */ (
    LoadingMessages
  );
  const messages = [
    ...(loadingMessages[category] || []),
    ...LoadingMessages.default,
  ];
  return messages[Math.floor(Math.random() * messages.length)];
};

export const updateLoadingMessage = (category = 'default') => {
  /** @type {HTMLElement | null} */
  const messageElement = document.getElementById('loading-message');
  if (messageElement) {
    messageElement.textContent = getRandomMessage(category);
  }
};

export const startLoadingMessageRotation = (category = 'default') => {
  // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®š
  updateLoadingMessage(category);

  // 3ç§’ã”ã¨ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
  loadingMessageTimer = setInterval(
    () => {
      updateLoadingMessage(category);
    },
    /** @type {number} */ (CONSTANTS.UI?.LOADING_MESSAGE_INTERVAL) || 3000,
  );
};

export const stopLoadingMessageRotation = () => {
  if (loadingMessageTimer) {
    clearInterval(loadingMessageTimer);
    loadingMessageTimer = null;
  }
};

appWindow.showLoading =
  appWindow.showLoading ||
  function (/** @type {string} */ category = 'default') {
    /** @type {HTMLElement | null} */
    const loadingElement = document.getElementById('loading');
    if (!loadingElement) return;

    // hiddenã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã€activeã‚¯ãƒ©ã‚¹ã‚’å³åº§ã«è¿½åŠ ã—ã¦è¡¨ç¤ºã™ã‚‹
    loadingElement.classList.remove('hidden');
    loadingElement.classList.add('active');

    startLoadingMessageRotation(category);
  };

appWindow.hideLoading =
  appWindow.hideLoading ||
  function () {
    /** @type {HTMLElement | null} */
    const loadingElement = document.getElementById('loading');
    if (!loadingElement) return;

    loadingElement.classList.remove('active');

    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆå®Œäº†å¾Œã«å®Œå…¨ã«éè¡¨ç¤º
    setTimeout(() => {
      loadingElement.classList.add('hidden');
      stopLoadingMessageRotation();
    }, 300); // CSS transitionã¨åŒã˜æ™‚é–“
  };

// =================================================================
// --- Modal System (Moved) ---
// -----------------------------------------------------------------
// ãƒ¢ãƒ¼ãƒ€ãƒ«ç®¡ç†æ©Ÿèƒ½ã¯ 12_WebApp_Core_Modal.js ã«ç§»å‹•ã—ã¾ã—ãŸã€‚
// =================================================================

// =================================================================
// --- Debug Logging System ---
// -----------------------------------------------------------------
// ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚’è¨±å¯ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ?debug=true ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã®ã¿å‡ºåŠ›ã•ã‚Œã‚‹
// =================================================================

/**
 * ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @returns {boolean}
 */
export const isDebugMode = () => {
  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‹ã‚‰æ¸¡ã•ã‚ŒãŸãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°ã‚’å„ªå…ˆ
  if (typeof window.SERVER_DEBUG_MODE !== 'undefined') {
    return window.SERVER_DEBUG_MODE;
  }

  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯ï¼ˆGASã®iframeå†…ã§ã¯æ©Ÿèƒ½ã—ãªã„å ´åˆãŒã‚ã‚‹ï¼‰
  try {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('debug') === 'true';
  } catch (_e) {
    return false;
  }
};

/**
 * ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹
 * @param {...any} args - å‡ºåŠ›ã™ã‚‹å†…å®¹
 */
export const debugLog = (...args) => {
  if (isDebugMode()) {
    console.log('[DEBUG]', ...args);
  }
};

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ã‚‚å…¬é–‹ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼äº’æ›æ€§ã®ãŸã‚ï¼‰
appWindow.debugLog = debugLog;

// =================================================================
// --- Event Listener Management ---
// -----------------------------------------------------------------
// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²ãƒ»è§£é™¤ã‚’è¿½è·¡ç®¡ç†ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ç¾¤
// ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢ã®ãŸã‚ã€ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã«å¤ã„ãƒªã‚¹ãƒŠãƒ¼ã‚’ç¢ºå®Ÿã«è§£é™¤ã™ã‚‹
// =================================================================

/** @type {Array<{element: Element, type: string, listener: EventListener, options?: AddEventListenerOptions}>} */
/** @type {Array<{ element: Element; type: string; listener: EventListener; options?: AddEventListenerOptions }>} */
export let activeListeners = [];
let viewListenerSetup = false;

/**
 * ç™»éŒ²ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å…¨ã¦è§£é™¤ã™ã‚‹
 */
export function teardownAllListeners() {
  activeListeners.forEach(({ element, type, listener, options }) => {
    if (element) {
      element.removeEventListener(type, listener, options);
    }
  });
  activeListeners = [];
}

/**
 * ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã—ã€è§£é™¤ã§ãã‚‹ã‚ˆã†ã«è¿½è·¡ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
 * @param {Element} element - å¯¾è±¡è¦ç´ 
 * @param {string} type - ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—
 * @param {EventListener} listener - ãƒªã‚¹ãƒŠãƒ¼é–¢æ•°
 * @param {AddEventListenerOptions} [options] - addEventListenerã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
 */
export function addTrackedListener(element, type, listener, options) {
  if (!element) {
    console.warn(
      `Attempted to add listener to a null element for event: ${type}`,
    );
    return;
  }
  element.addEventListener(type, listener, options);
  if (options) {
    activeListeners.push({ element, type, listener, options });
  } else {
    activeListeners.push({ element, type, listener });
  }
}

/**
 * StateManagerã®åˆæœŸåŒ–å¾Œã«è¿½åŠ ã™ã‚‹é–¢æ•°
 * ãƒ“ãƒ¥ãƒ¼å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç®¡ç†ã‚’è¨­å®š
 */
export function setupViewListener() {
  debugLog('ğŸ”Œ setupViewListener called');
  if (!appWindow.stateManager) {
    console.error('StateManager not initialized. Cannot set up view listener.');
    return;
  }
  if (viewListenerSetup) {
    return;
  }
  viewListenerSetup = true;

  const handleViewChange = (
    /** @type {UIState} */ newState,
    /** @type {UIState} */ oldState,
  ) => {
    // ãƒ“ãƒ¥ãƒ¼ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã®ã¿å‡¦ç†
    if (newState.view !== oldState.view) {
      // å¤ã„ãƒ“ãƒ¥ãƒ¼ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’å…¨ã¦è§£é™¤
      teardownAllListeners();

      // æ–°ã—ã„ãƒ“ãƒ¥ãƒ¼ã«å¿œã˜ãŸãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²
      // requestAnimationFrameã§DOMã®æç”»ã‚’å¾…ã¤
      requestAnimationFrame(() => {
        // PCè¡¨ç¤ºã‚µãƒãƒ¼ãƒˆï¼šãƒ“ãƒ¥ãƒ¼ã«å¿œã˜ãŸã‚³ãƒ³ãƒ†ãƒŠå¹…ã®èª¿æ•´
        const appElement = document.getElementById('app');
        if (appElement) {
          // ãƒ¯ã‚¤ãƒ‰è¡¨ç¤ºï¼ˆæœ€å¤§å¹…1280pxï¼‰ãŒå¿…è¦ãªãƒ“ãƒ¥ãƒ¼ã®ãƒªã‚¹ãƒˆ
          // participants: å‚åŠ è€…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
          // adminLog: æ“ä½œãƒ­ã‚°ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
          // dashboard: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã«ã‚ˆã‚Šæ¨™æº–å¹…ï¼ˆ~768pxï¼‰ã«æˆ»ã™
          const wideViews = ['participants', 'adminLog'];
          if (wideViews.includes(/** @type {string} */ (newState.view))) {
            appElement.classList.add('app-wide');
          } else {
            appElement.classList.remove('app-wide');
          }
        }

        if (newState.view === 'accounting') {
          // ä¼šè¨ˆç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸéš›ã®åˆæœŸåŒ–å‡¦ç†
          // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯14_WebApp_Handlers.htmlã®ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ã§å‡¦ç†ã•ã‚Œã¾ã™ã€‚
          // ã“ã“ã§ã¯ã€DOMæç”»å¾Œã«åˆå›è¨ˆç®—ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
          if (typeof updateAccountingCalculation === 'function') {
            // ä¼šè¨ˆç”»é¢ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const classifiedItems =
              appWindow.currentClassifiedItems ||
              /** @type {ClassifiedAccountingItemsCore} */ (
                /** @type {unknown} */ ({
                  tuition: { items: [] },
                  sales: { materialItems: [], productItems: [] },
                })
              );
            const classroom = appWindow.currentClassroom || '';
            updateAccountingCalculation(classifiedItems, classroom);
          }
        }
        // ä»–ã®ãƒ“ãƒ¥ãƒ¼ã§ãƒªã‚¹ãƒŠãƒ¼ãŒå¿…è¦ãªå ´åˆã¯ã“ã“ã«è¿½åŠ 
        // else if (newState.view === 'someOtherView') {
        //   setupSomeOtherViewListeners();
        // }
      });
    }
  };

  appWindow.stateManager.subscribe(handleViewChange);

  // åˆæœŸãƒ“ãƒ¥ãƒ¼ã«å¯¾ã—ã¦ã‚‚ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè¡Œï¼ˆoldState.view ã‚’ null ã«ã—ã¦å¿…ãšå·®åˆ†ç™ºç”Ÿï¼‰
  const currentState = appWindow.stateManager.getState?.();
  if (currentState) {
    handleViewChange(
      currentState,
      /** @type {UIState} */ (/** @type {unknown} */ ({ view: null })),
    );
  }
}

// Expose globally for initialization
if (typeof appWindow !== 'undefined') {
  /** @type {any} */ (appWindow).setupViewListener = setupViewListener;
}
