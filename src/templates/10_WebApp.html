<!doctype html>
<!--
=================================================================
ã€ãƒ•ã‚¡ã‚¤ãƒ«åã€‘: 10_WebApp.html
ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€‘: 26.0 (ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–å¯¾å¿œç‰ˆ)
ã€æ›´æ–°æ—¥æ™‚ã€‘: 2025-08-04
ã€èª¬æ˜ã€‘:
- è¨­å®šã¨ãƒ¢ãƒƒã‚¯æ©Ÿèƒ½ã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢
- ã‚ˆã‚Šä¿å®ˆæ€§ã®é«˜ã„æ§‹é€ ã«æ”¹å–„
- ãƒ†ã‚¹ãƒˆç’°å¢ƒã¨ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã®åˆ†é›¢
=================================================================
-->

<html lang="ja" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <base target="_top" />
    <title>ãã¼ã‚Šã® ã‚ˆã‚„ããƒ»ãã‚ã å·å´èª äºŒæœ¨å½«ã‚Šæ•™å®¤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700&family=Courier+Prime:wght@400;700&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media = 'all'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700&family=Courier+Prime:wght@400;700&display=swap"
        rel="stylesheet"
      />
    </noscript>
    <style>
      /* Courier Prime ã®ãƒ•ã‚©ãƒ³ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã«åˆã‚ã›ã¦èª¿æ•´ */
      @font-face {
        font-family: 'Courier Prime Adjusted';
        src: url(https://fonts.gstatic.com/s/courierprime/v11/u-450q2lgwslOqpF_6gQ8kELWwY.ttf)
          format('truetype');
        font-weight: 400;
        font-display: swap;
        ascent-override: 85%;
        descent-override: 15%;
        line-gap-override: 0%;
        size-adjust: 120%;
      }
      @font-face {
        font-family: 'Courier Prime Adjusted';
        src: url(https://fonts.gstatic.com/s/courierprime/v11/u-4k0q2lgwslOqpF_6gQ8kELY7pMf-c.ttf)
          format('truetype');
        font-weight: 700;
        font-display: swap;
        ascent-override: 85%;
        descent-override: 15%;
        line-gap-override: 0%;
        size-adjust: 120%;
      }
      :root {
        --brand-text: #4e342e;
        --brand-bg: #fffdf5;
      }
      body {
        font-family:
          'Courier Prime Adjusted', 'Zen Kaku Gothic New', sans-serif;
        font-feature-settings: 'tnum' 1;
        font-variant-numeric: tabular-nums;
        color: var(--brand-text);
        background-color: var(--brand-bg);
        line-height: 1.6;
      }
      /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã®é€æ˜åº¦ */
      input::placeholder {
        opacity: 0.6;
      }
      /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã¯ãƒ•ã‚©ãƒ³ãƒˆã‚’ç¶™æ‰¿ã—ãªã„ã®ã§æ˜ç¤ºçš„ã«æŒ‡å®š */
      input,
      select,
      textarea,
      button {
        font-family: inherit;
      }
      .markdown-content h1,
      .markdown-content h2,
      .markdown-content h3 {
        margin-top: 1.2em;
        margin-bottom: 0.6em;
        font-weight: bold;
      }
      .markdown-content h1 {
        font-size: 1.5em;
      }
      .markdown-content h2 {
        font-size: 1.25em;
      }
      .markdown-content h3 {
        font-size: 1.1em;
      }
      .markdown-content p {
        margin-bottom: 1em;
      }
      .markdown-content ul {
        list-style-type: disc;
        margin-left: 1.5em;
        margin-bottom: 1em;
      }
      .markdown-content li {
        margin-bottom: 0.25em;
      }
      .markdown-content a {
        color: #2563eb; /* blue-600 */
        text-decoration: underline;
      }
      .markdown-content strong {
        font-weight: bold;
      }

      /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
      @keyframes slideDown {
        from {
          opacity: 0;
          max-height: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          max-height: 5000px;
          transform: translateY(0);
        }
      }

      .animate-slideDown {
        animation: slideDown 0.3s ease-out forwards;
      }

      /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤ºã«ã™ã‚‹ã‚¯ãƒ©ã‚¹ */
      .scrollbar-hide {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>

  <body class="bg-brand-bg h-full">
    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯éè¡¨ç¤ºï¼‰ -->

    <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="app" class="container mx-auto px-4">
      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
      <div
        id="loading"
        class="loading-fade fixed inset-0 flex flex-col items-center justify-center z-50"
      >
        <div class="spinner mb-5"></div>
        <p
          id="loading-message"
          class="text-brand-text text-xl leading-relaxed text-center max-w-xl px-4"
        >
          ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿ä¸­...
        </p>
      </div>

      <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
      <main id="main-content" class="py-6 embedded-no-padding">
        <div id="view-container"></div>
      </main>

      <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
      <div id="modal-overlay" class="modal-overlay">
        <div id="modal-content" class="modal-content">
          <div id="modal-body"></div>
        </div>
      </div>

      <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
      <div
        id="custom-modal"
        class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50"
        onclick="if (event.target === this) hideModal();"
      >
        <div class="bg-white rounded-lg p-6 max-w-sm mx-4">
          <h3 id="modal-title" class="text-lg font-bold mb-4"></h3>
          <div id="modal-message" class="mb-6"></div>
          <div id="modal-buttons" class="flex gap-3 justify-end"></div>
        </div>
      </div>
      <footer class="text-center text-sm text-brand-muted mt-4">
        <p>ãã¼ã‚Šã® ã‚ˆã‚„ããƒ»ãã‚ã</p>
        <p class="mt-2">
          <span
            id="privacy-policy-link"
            data-action="showPrivacyPolicy"
            class="text-brand-muted underline hover:text-brand-text cursor-pointer"
            >ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</span
          >
        </p>
      </footer>
    </div>

    <!-- __UNIFIED_JAVASCRIPT_INJECTION_POINT__ -->

    <script>
      // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹é–¢æ•°ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ç„¡åŠ¹åŒ–ï¼‰
      function debugLog(message) {
        if (
          typeof CONSTANTS !== 'undefined' &&
          CONSTANTS.ENVIRONMENT?.PRODUCTION_MODE
        )
          return; // æœ¬ç•ªç’°å¢ƒã§ã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„
        console.log(
          'ğŸ” [DEBUG]',
          new Date().toLocaleTimeString() + ':',
          message,
        );
      }
      // æœ€åˆã®ãƒ†ã‚¹ãƒˆ - ã“ã‚ŒãŒè¡¨ç¤ºã•ã‚Œãªã‘ã‚Œã°HTMLãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„
      debugLog('HTMLãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ç¢ºèªãƒ†ã‚¹ãƒˆå®Œäº†');
      debugLog('ãƒšãƒ¼ã‚¸URL: ' + window.location.href);

      // GASç’°å¢ƒã‹ã©ã†ã‹ã‚’åˆ¤å®š
      const isGAS =
        typeof google !== 'undefined' && typeof google.script !== 'undefined';
      debugLog('GASç’°å¢ƒåˆ¤å®š: ' + isGAS);

      function isPreloadedDataValid() {
        if (!window.appCache.initialData || !window.appCache.timestamp) {
          return false;
        }

        var age = Date.now() - window.appCache.timestamp;
        return age < window.appCache.maxAge;
      }

      function initializeApp() {
        debugLog('initializeAppå®Ÿè¡Œé–‹å§‹');
        debugLog('isGAS: ' + isGAS);

        // æœ€é©åŒ–ã•ã‚ŒãŸåˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2æ”¹è‰¯ç‰ˆï¼‰
        function safeInitializeApp() {
          // å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç¢ºèª
          var allReady = true;
          var missingComponents = [];

          if (typeof DesignConfig === 'undefined') {
            allReady = false;
            missingComponents.push('DesignConfig');
          }
          if (typeof window.stateManager === 'undefined') {
            allReady = false;
            missingComponents.push('stateManager');
          }
          if (
            typeof window.stateManager !== 'undefined' &&
            typeof window.stateManager.dispatch !== 'function'
          ) {
            allReady = false;
            missingComponents.push('stateManager.dispatch');
          }
          if (typeof hideLoading !== 'function') {
            allReady = false;
            missingComponents.push('hideLoading');
          }

          debugLog(
            'åˆæœŸåŒ–æ¡ä»¶ãƒã‚§ãƒƒã‚¯ - ä¸è¶³: ' + missingComponents.join(', '),
          );

          if (allReady) {
            // å…¨ã¦æº–å‚™å®Œäº† - å³åº§ã«åˆæœŸåŒ–å®Ÿè¡Œ
            debugLog('âš¡ é«˜é€ŸåˆæœŸåŒ–å®Ÿè¡Œ - å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæº–å‚™å®Œäº†ï¼');
            debugLog(
              'stateManager.getState().lessons: ' +
                (window.stateManager.getState().lessons
                  ? window.stateManager.getState().lessons.length + 'ä»¶'
                  : 'null'),
            );

            // å¾©å…ƒã•ã‚ŒãŸçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦é©åˆ‡ãªç”»é¢ã«é·ç§»
            var restoredState = window.stateManager.getState();
            if (restoredState.currentUser) {
              // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã‚‹å ´åˆã¯å¾©å…ƒã•ã‚ŒãŸãƒ“ãƒ¥ãƒ¼ã¸ï¼ˆãªã‘ã‚Œã°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰
              debugLog(
                'âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ: ' + restoredState.currentUser.nickname,
              );
              window.stateManager.dispatch({
                type: 'SET_STATE',
                payload: { view: restoredState.view || 'dashboard' },
              });
            } else {
              window.stateManager.dispatch({
                type: 'SET_STATE',
                payload: { view: 'login' },
              });
            }
            hideLoading();
          } else {
            // ä¸€éƒ¨æœªæº–å‚™ - 100msé–“éš”ã§ãƒªãƒˆãƒ©ã‚¤ï¼ˆ300ms â†’ 100ms ã«çŸ­ç¸®ï¼‰
            setTimeout(safeInitializeApp, 100);
          }
        }

        // æœ€é©åŒ–ã•ã‚ŒãŸåˆæœŸåŒ–é–‹å§‹
        safeInitializeApp();
      }

      if (isGAS) {
        // GASæœ¬ç•ªç’°å¢ƒã®ã¿åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', () => {
          initializeApp();
        });
      }
    </script>
  </body>
</html>
