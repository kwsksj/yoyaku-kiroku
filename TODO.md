# 📋 Backlog (タスク管理)

## Inbox (未整理メモ)

<!-- ここに思いついたことを雑に書いてください。後で整理・分類します。 -->

- ***

## タスク一覧

| #   | カテゴリ    | タスク                                     | 優先度() | 優先度(AI) | 工数 | リスク | 状態   |
| --- | ----------- | ------------------------------------------ | -------- | ---------- | ---- | ------ | ------ |
| 1   | UI          | 参加者/ログビューにデータ取得日時を表示    |          | 低         | 小   | 低     | 未着手 |
| 2   | UI          | よやく詳細画面の販売品項目の見え方調整     |          | 低         | 小   | 低     | 未着手 |
| 3   | Performance | ログイン時に参加者ビューのデータも取得     |          | 低         | 中   | 低     | 検討中 |
| 4   | Bug         | インクリメンタルキャッシュ更新の検証       |          | 中         | 小   | 低     | 未着手 |
| 5   | Bug         | 管理者ログイン時のビュー遷移タイミング改善 |          | 低         | 小   | 低     | 未着手 |
| 6   | UI          | 会計画面のUIを統一                         |          | 中         | 中   | 低     | 未着手 |
| 7   | UI          | 予約画面のデザイン統一                     |          | 中         | 中   | 低     | 未着手 |
| 8   | UI          | みんなのよやく・きろく PC表示調整          |          | 低         | 中   | 低     | 未着手 |
| 9   | UI          | システム全体のPC表示対応                   |          | 低         | 大   | 中     | 未着手 |
| 10  | UI          | 新規登録画面にウェルカムメッセージ表示     |          | 低         | 小   | 低     | 未着手 |
| 11  | Feature     | ユーザーページ遷移ログの可視化             |          | 低         | 中   | 低     | 未着手 |
| 12  | Feature     | 画像アップロード機能                       |          | 低         | 大   | 中     | 未着手 |
| 13  | Feature     | `setDataFreshness` 機能の実装              |          | 低         | 小   | 低     | 未着手 |
| 14  | Performance | 終了フロー中の入力リアルタイム保存         |          | 低         | 小   | 低     | 未着手 |
| 15  | Performance | 参加者/ログビューのデータ同時取得          |          | 低         | 中   | 低     | 未着手 |
| 16  | Refactor    | 不要なconsole.log削除                      |          | 中         | 小   | 低     | 未着手 |
| 17  | Refactor    | フォーム入力キャッシュの重複コード削減     |          | 低         | 小   | 低     | 未着手 |
| 18  | Refactor    | 型定義の整備（formInputCache）             |          | 低         | 小   | 低     | 未着手 |

---

## タスク詳細

### #1 参加者/ログビューにデータ取得日時を表示

- 参加者ビュー、ログビューで表示しているデータの取得日時を上部に控えめに表示する

### #2 よやく詳細画面の販売品項目の見え方調整

- 販売品項目の表示レイアウトを改善

### #3 ログイン時に参加者ビューのデータも取得

- 管理者ログイン時のデータ取得を最適化
- 現状: ログイン後に別途参加者データを取得
- 検討: 一括取得でAPI呼び出し削減

### #4 インクリメンタルキャッシュ更新の検証

- `src/backend/05-2_Backend_Write.js` L545付近に「要確認」コメントあり
- 新規予約時の `addReservationToCache(rowForCache, headerMap)` のデータ形式を確認
- 備考: エラー時は `rebuildAllReservationsCache()` でフォールバック済み

### #5 管理者ログイン時のビュー遷移タイミング改善

- 現状: データ取得完了前にビュー遷移が発生する可能性
- 対象: `src/frontend/14_WebApp_Handlers_Auth.js` L124-176
- 備考: 現在は `adminLogs` を事前にstateに保存してから `goToLogView()` を呼んでおり、実運用で問題なし

### #6 会計画面のUIを統一

- 他の画面との統一感を持たせる
- デザイン検討が必要

### #7 予約画面のデザイン統一

- セッション終了フローの予約画面と似たデザインにする

### #8 みんなのよやく・きろく PC表示調整

- PC表示時のレイアウト調整
- コンテナの表示幅を広く固定し、スクロールをコンテナ全体に対しておこなうようにする

### #9 システム全体のPC表示対応

- PC表示時の状態について調査検討と修正
- 影響範囲が広いため慎重に対応

### #10 新規登録画面にウェルカムメッセージ表示

- 入力画面の前に簡単な説明を表示
- UX改善

### #11 ユーザーページ遷移ログの可視化

- ユーザーのページ遷移・画面表示ログの取得・可視化
- 分析用途

### #12 画像アップロード機能

- 進捗状況を写真でアップしてもらう仕組み
- 講師が生徒について思い出しやすくなる
- 生徒自身が進捗を振り返れる
- 生徒同士で進捗を共有できる
- ストレージ: Google Drive（2TB中79GB使用、余裕あり）

### #13 `setDataFreshness` 機能の実装

- 予約完了時などに再取得を防ぐフラグ管理機能
- `SimpleStateManager` に `setDataFreshness(key, boolean)` メソッド追加
- 対象: `src/frontend/14_WebApp_Handlers_Reservation.js` L1368付近にTODOコメントあり

### #14 終了フロー中の入力リアルタイム保存

- 現状: ステップ移動時にのみキャッシュ更新
- 改善: 各ステップの textarea/input に `input` イベントリスナーを追加
- 対象: きろく、もくひょう、よやく（材料/注文品）、会計

### #15 参加者/ログビューのデータ同時取得

- バックエンドに統合エンドポイント追加
- または既存エンドポイント拡張で1回のAPI呼び出しに
- 対象: `getAdminLogsWithMetadata` と参加者データ取得の統合

### #16 不要なconsole.log削除

- `src/frontend/` 配下に100箇所以上の `console.log` あり
- 開発専用ログは `debugLog` に統一、または本番ビルド時に除去を検討

### #17 フォーム入力キャッシュの重複コード削減

- ダッシュボード・履歴ビューで重複している `input` イベントリスナー設定を共通化
- `SimpleStateManager` に `setupTextareaCache(textarea, cacheKey)` メソッド追加
- 📄 実装詳細: [docs/RELOAD_OPTIMIZATION.md](docs/RELOAD_OPTIMIZATION.md)

### #18 型定義の整備（formInputCache）

- `UIState` インターフェースに `formInputCache` プロパティを明示的に追加
- ブラケット表記（`state['formInputCache']`）から通常のプロパティアクセスへ変更
- 型安全性の向上
- 📄 実装詳細: [docs/RELOAD_OPTIMIZATION.md](docs/RELOAD_OPTIMIZATION.md)

---

## Completed (完了済み)

### 2026/01

- [x] **リロード時のローディング状態管理改善** ⭐ (2026-01-15)
- [x] **状態復元時のビュー不整合対策** (2026-01-15)
- [x] **リロード時の二重データ取得防止** (2026-01-15)
- [x] **データ再取得のタイムアウト処理** (2026-01-15)
- [x] **ローカルデータキャッシュ機能** (2026-01-15)
- [x] **参加者ビューのフィルター切り替えをピルトグルに変更** (2026-01-15)
- [x] **参加者ビューデータの保存とリロード復元** (2026-01-16)
- [x] **参加者ビューの更新ボタンを全ユーザーに表示** (2026-01-16)
- [x] **状態復元ロジックの整理** (2026-01-15)
- [x] **ログイン種別の追加** (2026-01-15)
- [x] **ログイン処理とデータ再取得の分離** (2026-01-15)
- [x] **リロード時データ再取得エラーのユーザー通知** (2026-01-11)
- [x] **初回判定ロジック調査・切り替えスイッチ改善** (2026-01-11)
- [x] **画面リロード時のデータ復元**
- [x] **セッション終了フロー改善**
- [x] **管理者モードでログ内容をアプリ内で確認可能にする**
- [x] **ログシートの記載内容改善**
- [x] **ログビューの改善**
- [x] **セッション終了フロー予約画面UI改善**
- [x] **SessionConclusionリファクタリング**
- [x] **フォーム入力保持機能**

### 2025/12

- [x] 売上自動転載バグ修正
- [x] ログシート空行バグ修正
- [x] ログ/予約シート昇順ソート対応
- [x] ログシート自動スクロール機能追加
- [x] きろくカードのシンプル化
- [x] きろくカードのリストビュー化
