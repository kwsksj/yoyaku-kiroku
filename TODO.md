# 📋 Backlog (タスク管理)

## Inbox (未整理メモ)

<!-- ここに思いついたことを雑に書いてください。後で整理・分類します。 -->

- キャンセルがうまくいかない報告

- 初回予約を複数していた人（仮にAさん）が、初回を体験した場合、Aさんの他の予約の初回フラグを解除する
- 予約枠が経験者枠に変更されたことで、初回予約枠が空いた場合に初回枠待機の人へ連絡する（現在はキャンセル時の場合のみに連絡している）
- さらに、Aさんが初回予約待機が、からも初回フラグが取り除かれることで、経験者として予約が可能になる場合があるので、その場合も連絡する
  - 具体例
    - 1/18 初回予約
    - 1/25 初回予約待機
  - その後1/18の初回参加が完了
    - 1/18 初回 完了済み
    - 1/25 予約待機（経験者枠）に変更。これにより予約可能になった場合、空き連絡

## タスク一覧

| #   | カテゴリ    | タスク                                   | 優先度() | 優先度(AI) | 工数 | リスク |
| --- | ----------- | ---------------------------------------- | -------- | ---------- | ---- | ------ |
| 1   | UI          | よやく詳細画面の販売品項目の見え方調整   |          | 低         | 小   | 低     |
| 3   | UI          | 会計画面のUIを統一                       |          | 中         | 中   | 低     |
| 4   | UI          | 予約画面のデザイン統一                   |          | 中         | 中   | 低     |
| 5   | UI          | みんなのよやく・きろく PC表示調整        |          | 低         | 中   | 低     |
| 6   | UI          | システム全体のPC表示対応                 |          | 低         | 大   | 中     |
| 7   | UI          | 新規登録画面にウェルカムメッセージ表示   |          | 低         | 小   | 低     |
| 8   | Feature     | ユーザーページ遷移ログの可視化           |          | 低         | 中   | 低     |
| 9   | Feature     | 画像アップロード機能                     |          | 低         | 大   | 中     |
| 10  | Feature     | `setDataFreshness` 機能の実装            |          | 低         | 小   | 低     |
| 11  | Performance | 終了フロー中の入力リアルタイム保存       |          | 低         | 小   | 低     |
| 12  | Refactor    | 不要なconsole.log削除                    |          | 中         | 小   | 低     |
| 13  | UI          | iPhone表示の調整                         |          | 中         | 中   | 低     |
| 14  | Feature     | 終了フローで彫刻刀レンタルオプション表示 |          | 中         | 中   | 低     |

---

## タスク詳細

### #1 よやく詳細画面の販売品項目の見え方調整

- 販売品項目の表示レイアウトを改善

### #3 会計画面のUIを統一

- 他の画面との統一感を持たせる
- デザイン検討が必要

### #4 予約画面のデザイン統一

- セッション終了フローの予約画面と似たデザインにする

### #5 みんなのよやく・きろく PC表示調整

- PC表示時のレイアウト調整
- コンテナの表示幅を広く固定し、スクロールをコンテナ全体に対しておこなうようにする

### #6 システム全体のPC表示対応

- PC表示時の状態について調査検討と修正
- 影響範囲が広いため慎重に対応

### #7 新規登録画面にウェルカムメッセージ表示

- 入力画面の前に簡単な説明を表示
- UX改善

### #8 ユーザーページ遷移ログの可視化

- ユーザーのページ遷移・画面表示ログの取得・可視化
- 分析用途

### #9 画像アップロード機能

- 進捗状況を写真でアップしてもらう仕組み
- 講師が生徒について思い出しやすくなる
- 生徒自身が進捗を振り返れる
- 生徒同士で進捗を共有できる
- ストレージ: Google Drive（2TB中79GB使用、余裕あり）

### #10 `setDataFreshness` 機能の実装

- 予約完了時などに再取得を防ぐフラグ管理機能
- `SimpleStateManager` に `setDataFreshness(key, boolean)` メソッド追加
- 対象: `src/frontend/14_WebApp_Handlers_Reservation.js` L1368付近にTODOコメントあり

### #11 終了フロー中の入力リアルタイム保存

- 現状: ステップ移動時にのみキャッシュ更新
- 改善: 各ステップの textarea/input に `input` イベントリスナーを追加
- 対象: きろく、もくひょう、よやく（材料/注文品）、会計

### #12 不要なconsole.log削除

- `src/frontend/` 配下に100箇所以上の `console.log` あり
- 開発専用ログは `debugLog` に統一、または本番ビルド時に除去を検討

### #13 iPhone表示の調整

- iPhoneなどでの表示をAIで確認・調整
- 対応方法: iPhone画面でのスクリーンショットを撮ってAIに確認してもらう

### #14 終了フローで彫刻刀レンタルオプション表示

- セッション終了フローの予約ステップで彫刻刀レンタルオプションを表示
- 次回のメッセージや材料希望の欄に追加、または別枚でオプション表示

---

## Completed (完了済み)

### 2026/01

- [x] **電話番号重複チェックの強化（シート直接参照）** (2026-01-19)
- [x] **当日終了時刻後のレッスン非表示** (2026-01-19)
- [x] **受講済み日程への予約防止** (2026-01-19)
- [x] **終了フローでの経験者日程表示強制** (2026-01-19)
- [x] **参加者ビューの予約リストから完了ステータスを除外** (2026-01-19)
- [x] **会計完了済み予約のキャンセル禁止** (2026-01-19)
- [x] **セッション終了フローからの予約時の会場名保存確認** (2026-01-19)
- [x] **ログアクションの色分け定義追加** (2026-01-19)
- [x] **インクリメンタルキャッシュ更新の検証** (2026-01-18)
- [x] **リロード時のローディング状態管理改善** ⭐ (2026-01-15)
- [x] **状態復元時のビュー不整合対策** (2026-01-15)
- [x] **リロード時の二重データ取得防止** (2026-01-15)
- [x] **データ再取得のタイムアウト処理** (2026-01-15)
- [x] **ローカルデータキャッシュ機能** (2026-01-15)
- [x] **参加者ビューのフィルター切り替えをピルトグルに変更** (2026-01-15)
- [x] **参加者ビューデータの保存とリロード復元** (2026-01-16)
- [x] **参加者ビューの更新ボタンを全ユーザーに表示** (2026-01-16)
- [x] **参加者/ログビューのリフレッシュロジック最適化** (2026-01-16)
  - データ同時取得、バックグラウンド更新、差分なし時の軽量モーダル表示
- [x] **参加者/ログビューにデータ取得日時を表示** (2026-01-16)
- [x] **ログイン時に参加者ビューのデータも取得** (2026-01-16)
- [x] **管理者ログイン時のビュー遷移タイミング改善** (2026-01-17)
- [x] **参加者/ログビューのデータ同時取得** (2026-01-17)
- [x] **フォーム入力キャッシュの重複コード削減** (2026-01-17)
- [x] **型定義の整備（formInputCache）** (2026-01-17)
- [x] **終了フローのログアクション改善** (2026-01-17)
  - セッションノート更新（終了フロー）、けいかく更新（終了フロー）、よやく作成（終了フロー）
- [x] **終了フローの重複予約防止** (2026-01-17)
  - 既存予約がある場合は新規作成をスキップ
- [x] **状態復元ロジックの整理** (2026-01-15)
- [x] **ログイン種別の追加** (2026-01-15)
- [x] **ログイン処理とデータ再取得の分離** (2026-01-15)
- [x] **リロード時データ再取得エラーのユーザー通知** (2026-01-11)
- [x] **初回判定ロジック調査・切り替えスイッチ改善** (2026-01-11)
- [x] **画面リロード時のデータ復元**
- [x] **セッション終了フロー改善**
- [x] **管理者モードでログ内容をアプリ内で確認可能にする**
- [x] **ログシートの記載内容改善**
- [x] **ログビューの改善**
- [x] **セッション終了フロー予約画面UI改善**
- [x] **SessionConclusionリファクタリング**
- [x] **フォーム入力保持機能**

### 2025/12

- [x] 売上自動転載バグ修正
- [x] ログシート空行バグ修正
- [x] ログ/予約シート昇順ソート対応
- [x] ログシート自動スクロール機能追加
- [x] きろくカードのシンプル化
- [x] きろくカードのリストビュー化
