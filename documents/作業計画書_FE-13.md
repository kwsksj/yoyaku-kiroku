# 作業計画書: FE-13 会計フローの再設計

【発行者】:
【発行日時】: 2025/07/08
【セッションID】:

---

## 1. 目的 (Objective)

ユーザー（生徒）が誤って会計処理を完了させてしまう事故を防ぎ、先生とのコミュニケーションを促進するため、会計フローに「確認」のステップを導入する。これにより、システムの信頼性とユーザー体験を向上させる。

## 2. 担当タスク概要 (Task Overview)

ロードマップ `v3.0` のタスク `FE-13` を実行する。

> **タスク内容:** 「支払いました」ボタンを「料金の確認」に変更し、確認モーダル（精算表、支払い方法、先生確認チェックボックス）を実装する。

## 3. 影響範囲 (Scope of Impact)

- **主要担当ファイル:**
  - `13_WebApp_Views.html`: UI（ビュー）の変更
  - `14_WebApp_Handlers.html`: アクション（ハンドラ）の変更
  - `12_WebApp_Core.html`: 既存のモーダル機能 (`showConfirm`) を利用

- **影響を受ける画面:**
  - 会計画面 (`getAccountingView`)

## 4. 実装ステップ (Implementation Steps)

### Step 1: UIの変更 (`13_WebApp_Views.html`)

1.  `getAccountingView` 関数内の、最終的な支払いボタンの定義を探す。
2.  ボタンのテキストを「支払いました」から「**料金の確認**」に変更する。
3.  ボタンの `data-action` 属性を `confirmAndPay` から、新しいアクション `showAccountingConfirmation` に変更する。

### Step 2: 確認モーダルの実装 (`13_WebApp_Views.html` / `14_WebApp_Handlers.html`)

1.  `14_WebApp_Handlers.html` に、新しいアクションハンドラ `showAccountingConfirmation` を作成する。
2.  このハンドラは、まず `calculateAccountingDetails()` を呼び出して、最終的な会計情報を取得する。
3.  取得した会計情報（合計金額、支払方法など）を整形し、モーダルに表示するためのHTML文字列を生成する。このHTMLには、以下の要素を含めること。
    - 合計金額のサマリー
    - 選択された支払方法
    - **「先生に内容を確認してもらいました」** という新しいチェックボックス
4.  `12_WebApp_Core.html` にある `showConfirm` 関数を呼び出し、上記で生成したHTMLをメッセージとして渡す。
5.  モーダルの「確定」ボタンのテキストは「**この内容で支払う**」とし、**デフォルトで無効 (disabled) 状態**にしておく。

### Step 3: モーダル内のインタラクション実装 (`14_WebApp_Handlers.html`)

1.  `showAccountingConfirmation` ハンドラ内で、モーダル表示後に「先生に確認...」チェックボックスにイベントリスナーを追加する。
2.  チェックボックスがチェックされたら、モーダル内の「この内容で支払う」ボタンの `disabled` 属性を解除する。チェックが外されたら、再度 `disabled` にする。
3.  `showConfirm` の `onConfirm` コールバックとして、元の支払い処理（`saveAccountingDetails` を呼び出すロジック）を定義する。

## 5. 受け入れ基準 (Acceptance Criteria)

- [ ] 会計画面の最終ボタンが「料金の確認」になっている。
- [ ] ボタンをクリックすると、会計内容の確認モーダルが表示される。
- [ ] モーダルには、合計金額、支払方法、「先生確認」チェックボックスが表示されている。
- [ ] 「この内容で支払う」ボタンは、初期状態でクリックできない。
- [ ] 「先生確認」チェックボックスをオンにすると、「この内容で支払う」ボタンがクリック可能になる。
- [ ] ボタンをクリックすると、正常に会計情報が保存され、処理が完了する。

---
以上