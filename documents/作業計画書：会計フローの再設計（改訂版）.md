# 作業計画書：会計フローの再設計（改訂版）

## 1. 目的 (Objective)

会計フローを簡素化し、先生の確認ステップを明確にすることで、ユーザーの誤操作を防ぎ、よりスムーズな会計体験を提供する。

## 2. 担当タスク概要 (Task Overview)

- 初期会計画面の変更
- 支払い方法詳細の削除
- 確認ボタンとテキストの追加
- 確認モーダルの実装
- 支払い処理の変更
- 完了画面への遷移

## 3. 影響範囲 (Scope of Impact)

**主要担当ファイル:**

- `13_WebApp_Views.html`: UI（ビュー）の変更
- `14_WebApp_Handlers.html`: アクション（ハンドラ）の変更
- `12_WebApp_Core.html`: モーダル表示機能の利用

**影響を受ける画面:**

- 会計画面 (`getAccountingView`)

## 4. 実装ステップ (Implementation Steps)

### Step 1: 初期会計画面の変更 (`13_WebApp_Views.html`)

- `getAccountingView` 関数内で、支払い方法の詳細表示部分を削除する。
- 合計金額表示の下に、テキスト「金額を、先生に確認してもらってください」を追加する。
- テキストの下に、ボタン「先生の確認完了」を追加し、`data-action` 属性を `showAccountingConfirmation` に設定する。

### Step 2: 確認モーダルの実装 (`14_WebApp_Handlers.html` / `12_WebApp_Core.html`)

- `14_WebApp_Handlers.html` に、アクションハンドラ `showAccountingConfirmation` を作成する。
- `showAccountingConfirmation` ハンドラ内で、`calculateAccountingDetails()` を呼び出して会計情報を取得する。
- 取得した情報から、モーダルに表示するHTML文字列を生成する。モーダルの内容は以下の通り。
  - 合計金額（コピーボタン付き）
  - 支払い方法の詳細と選択肢
  - ボタン「支払いました」
  - テキスト（赤字）「必ずボタンを押してね」
- `12_WebApp_Core.html` の `showConfirm` 関数を呼び出し、生成したHTMLをモーダルのメッセージとして渡す。

### Step 3: 支払い処理の変更 (`14_WebApp_Handlers.html`)

- モーダル内のボタン「支払いました」に紐づくアクションハンドラ `confirmAndPay` を `14_WebApp_Handlers.html` に作成する。
- `confirmAndPay` ハンドラ内で、`saveAccountingDetails` 関数を呼び出して会計情報を保存する。

### Step 4: 完了画面への遷移 (`14_WebApp_Handlers.html`)

- `saveAccountingDetails` の処理が成功した場合、`setState` を使って画面を「ありがとうございました」画面（completeビュー）に遷移させる。
- completeビューで、「続けて次の予約をされますか？」といったメッセージを表示し、「同じ教室の予約画面」へ遷移するボタンを設置する。

## 5. 受け入れ基準 (Acceptance Criteria)

- [ ] 初期会計画面から支払い方法の詳細表示が削除されている。
- [ ] 合計金額の下に「金額を、先生に確認してもらってください」というテキストが表示されている。
- [ ] テキストの下に「先生の確認完了」ボタンが表示され、クリックすると確認モーダルが表示される。
- [ ] 確認モーダルに、合計金額（コピーボタン付き）、支払い方法、ボタン「支払いました」、テキスト「必ずボタンを押してね」が表示される。
- [ ] モーダル内の「支払いました」ボタンをクリックすると、会計情報が保存され、完了画面に遷移する。
- [ ] 完了画面に、次の予約を促すメッセージと「同じ教室の予約画面」へ遷移するボタンが表示される。
