# 統合開発計画書

## 1. はじめに

このドキュメントは、既存の `ACTION_PLAN.md` と `COMPREHENSIVE_REFACTORING_PLAN.md` を統合し、現在のソースコードの状況を反映させた、最新の統一開発計画書です。

今後の開発作業は、原則としてこのドキュメントに基づいて進捗を管理します。

## 2. 全体方針

引き続き、アプリケーションの**パフォーマンス、保守性、信頼性**の向上を最優先事項とします。

タスクは以下のカテゴリに分類し、優先度順に実施します。

1. **データ整合性と信頼性の向上**
2. **保守性と開発効率の向上**
3. **品質保証と将来への投資**

## 3. 開発タスクリスト

チェックボックス `[ ]` を使ってタスクの進捗を管理してください。

### 【優先度: 高】データ整合性と信頼性の向上

アプリケーションの安定動作に直結する、最優先で対応すべきタスクです。

- [x] **データ書き込み処理の最適化**
  - **内容**: プロフィール更新や予約更新の処理を、現在の全データ書き換え方式から、変更があった行のみを更新する「ピンポイント更新」方式にリファクタリングします。
  - **目的**: 書き込み処理の負荷を劇的に軽減し、複数人利用時のデータ競合リスクを低減します。
  - **関連ファイル**: `src/04_Backend_User.js`, `src/05-2_Backend_Write.js`

- [x] **セッション判定ロジックの統一**
  - **内容**: 予約時の定員チェック（`checkCapacityFull`）で使われている古い判定ロジックを、日程マスタの時間を正とする新しい判定ロジックに統一します。
  - **目的**: アプリケーション内に混在している古いロジックを排除し、データの不整合を防ぎます。
  - **関連ファイル**: `src/05-2_Backend_Write.js`, `src/05-3_Backend_AvailableSlots.js`

### 【優先度: 中】保守性と開発効率の向上

コードの可読性を高め、今後の機能追加や修正を容易にするためのタスクです。

- [x] **マスタデータの一元化**
  - **内容**: 授業時間や定員といった、教室に関する設定情報を「日程マスタ」シートに集約します。関連する関数が、分散した定数ファイルや会計マスタではなく、日程マスタのキャッシュから情報を取得するように参照先を変更します。
  - **目的**: 複数箇所に分散しているマスタ情報を一元化し、メンテナンス性を向上させます。
  - **関連ファイル**: `src/05-2_Backend_Write.js`, `src/05-3_Backend_AvailableSlots.js`, `src/00_Constants.js` など

- [x] **エラーハンドリングの強化**
  - **内容**: サーバーサイドでエラーが発生した際に、より具体的で分かりやすいエラーメッセージをフロントエンドに返すように修正します。また、開発者が原因を追跡しやすいように、サーバー側のログ出力を充実させます。
  - **目的**: ユーザーがエラーに遭遇した際の混乱を減らし、開発者のデバッグ効率を向上させます。
  - **関連ファイル**: `src/08_ErrorHandler.js`, `src/14_WebApp_Handlers.html`

- [x] **UI/UXの統一**
  - **内容**: アプリケーション全体のボタンのレイアウト、文言、配色などのデザインに一貫性を持たせます。特に、フォーム画面や確認モーダルでのボタンの並び順やスタイルを統一します。
  - **目的**: ユーザーが直感的に操作できるよう、一貫したユーザー体験を提供します。
  - **関連ファイル**: `src/13_WebApp_Components.html`, `src/11_WebApp_Config.html`

- [ ] **ファイル命名規則の統一と整理**
  - **内容**: `src` ディレクトリ内のファイル名を `xx_Scope_Name.js` の規則に沿って見直します。特にプレフィックス `08_` の重複を解消し、不要な `.bak` ファイルを削除します。
  - **目的**: プロジェクト構造の可読性を高め、新規開発者がファイルを把握しやすくします。
  - **関連ファイル**: `src` ディレクトリ全体
  - **特記事項**: `08_ErrorHandler.js` と `08_Utilities.js` でプレフィックスが重複しています。汎用的なヘルパー関数を格納する `08_Utilities.js` は、`03_Utilities.js` など、より若い番号に変更することを推奨します。

- [x] **JSDocコメントの拡充**
  - **内容**: 主要な関数やデータ構造（オブジェクトのプロパティなど）に、型情報（`@param {string}`など）や役割を説明するJSDocコメントを追記・整備します。
  - **目的**: コードの可読性を高め、将来的なTypeScriptへのスムーズな移行を準備します。
  - **関連ファイル**: プロジェクト全体

### 【優先度: 低】品質保証と将来への投資

長期的な品質を担保し、システムの堅牢性を高めるためのタスクです。

- [ ] **バックエンドのユニットテスト整備**
  - **内容**: 主要なビジネスロジック（予約処理、料金計算、空き枠計算など）に対するユニットテストを作成します。`test` ディレクトリにテストファイルを追加していきます。
  - **目的**: リファクタリングや機能追加時の意図しない不具合（デグレード）を自動で検知できるようにし、コードの品質を担保します。
  - **関連ファイル**: `test/` ディレクトリ

- [ ] **設計ドキュメントの更新**
  - **内容**: 現在のアプリケーションの動作に合わせて、データフロー図（データの流れを図式化したもの）とステータス遷移図（予約ステータスの変化を図式化したもの）を作成・更新します。
  - **目的**: プロジェクトの全体像を可視化し、チーム内の認識を統一することで、将来の機能追加や改修をスムーズにします。
  - **関連ファイル**: `docs/` ディレクトリ

## 4. 現状の評価と次のステップ (2025-09-01)

**ソースコードの精査に基づき、本セクションを追記。**

### 評価

- **優先度「高」のタスクはすべて完了済み**であり、アプリケーションのデータ整合性と信頼性は大幅に向上しています。
- **優先度「中」のタスクも大部分が完了**しており、コードの保守性や開発効率は良好な状態にあります。
- 現在のコードベースは、計画書に沿って着実に改善が進んでいることが確認できました。

### 次のステップ

1. **ファイル命名規則の修正**: まず、優先度「中」で唯一残っている**ファイル命名規則の統一**に着手し、`08_`プレフィックスの重複を解消します。
2. **品質保証への投資**: その後、優先度「低」のタスクである**バックエンドのユニットテスト整備**に進みます。これにより、将来の機能追加やリファクタリングに対する安全網を構築し、システムの堅牢性をさらに高めます。
3. **ドキュメントの拡充**: テストと並行して、またはテスト完了後に**設計ドキュメントの更新**を行い、プロジェクトの全体像を最新の状態に保ちます。
