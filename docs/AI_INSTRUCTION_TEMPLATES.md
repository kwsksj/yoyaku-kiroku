# AI作業指示テンプレート集

**対象**: フロントエンド型安全性改善作業 **基準文書**: [FRONTEND_TYPE_SAFETY_STATUS_REPORT.md](FRONTEND_TYPE_SAFETY_STATUS_REPORT.md) **作成日**: 2025-09-17

---

## 🚨 Critical優先度：緊急修正

### Critical-1: Core機能緊急修正

```
@docs/FRONTEND_TYPE_SAFETY_STATUS_REPORT.md の分析結果に基づき、Critical優先度の「12_WebApp_Core.js 緊急修正」を実行してください。

【作業内容】
1. 重複定義の解消
   - `findReservationById`の重複定義修正
   - `FrontendErrorHandler`の重複定義修正
2. 暗黙any型の明示的型定義
   - `loadingMessageTimer`変数の型注釈追加
   - イベントハンドラー引数の型定義
3. モーダル関数の型整合性修正
   - `showModal`関数の型定義統一
   - モーダル設定オブジェクトの型安全性確保

【完了基準】
- TypeScript重複定義エラーが0件になること
- `npm run check`で型エラーが大幅減少すること
- VSCodeでの基本的な型補完が動作すること

【制約】
- 既存の機能を破壊しないこと
- 他ファイルへの影響を最小限に抑えること
- 修正後は必ず`npm run dev:test`で動作確認すること

推定作業時間: 2-3時間
```

---

## 🔥 High優先度：機能ブロック修正

### High-1: イベントハンドラー型安全性

```
@docs/FRONTEND_TYPE_SAFETY_STATUS_REPORT.md に基づき、High優先度の「イベントハンドラー型安全性確保」を実施してください。

【対象ファイル】
- `src/frontend/14_WebApp_Handlers.js`（メイン）
- 関連: `src/frontend/12_WebApp_Core.js`のイベント関連機能
- 必要に応じて、型定義ファイルも修正も可。ただし、全体の整合性を機能性を考慮

【作業内容】
1. イベントハンドラー関数の型注釈追加
   - 全てのイベントリスナー関数にパラメータ型を定義
   - 戻り値型の明示（void、Promise<void>等）
2. DOM要素アクセスの型安全性確保
   - `document.getElementById`の戻り値型チェック追加
   - HTMLElement型の適切なキャスト
3. ユーザー操作データの型定義適用
   - フォームデータの型安全性確保
   - バリデーション結果の型定義

【完了基準】
- イベントハンドラー関連の型エラーが解消されること
- `UIEventData`型の実用的な活用が確認できること
- ユーザー操作のデータフローが型安全になること

【アプローチ】
- types/html-environment.d.ts の既存型定義を最大活用
- 機能ブロック単位での一貫性を重視
- 段階的修正（Critical部分→全体）で進行

推定作業時間: 1週間
```

### High-2: DOM操作・UI表示型安全性

```
@docs/FRONTEND_TYPE_SAFETY_STATUS_REPORT.md に基づき、High優先度の「DOM操作・UI表示型安全性向上」を実施してください。

【対象ファイル】
- `src/frontend/13_WebApp_Views.js`（メイン）
- `src/frontend/13_WebApp_Components.js`（メイン）
- 関連: `src/frontend/12_WebApp_Core.js`のDOM関連機能
- 必要に応じて、型定義ファイルも修正も可。ただし、全体の整合性を機能性を考慮

【作業内容】
1. UI表示生成関数の型安全性確保
   - ビュー生成関数の戻り値型定義（string、HTMLElement等）
   - テンプレートデータの型注釈追加
2. コンポーネント関数の型定義適用
   - コンポーネント引数の型安全性確保
   - ComponentProps型の実用的活用
3. DOM操作ユーティリティの型注釈
   - HTML生成関数の型安全性向上
   - エスケープ処理の型整合性確保

【完了基準】
- DOM操作関連の型エラーが大幅減少すること
- ComponentProps、DisplayData型の実用的活用が確認できること
- HTML生成処理の型安全性が確保されること

【重点領域】
- 再利用可能コンポーネントの型安全性
- データ表示処理のtype safety
- HTMLテンプレート生成の型チェック

推定作業時間: 1週間
```

### High-3: API通信型安全性

```
@docs/FRONTEND_TYPE_SAFETY_STATUS_REPORT.md に基づき、High優先度の「API通信型安全性確保」を実施してください。

【対象範囲】
- google.script.run 関連のすべての通信処理
- API レスポンス処理
- エラーハンドリング
- 必要に応じて、型定義ファイルも修正も可。ただし、全体の整合性を機能性を考慮

【作業内容】
1. google.script.run通信の型安全性向上
   - API呼び出し関数の戻り値型定義
   - リクエストパラメータの型注釈
2. レスポンス処理の型安全性確保
   - 成功・失敗レスポンスの型定義適用
   - データ変換処理の型チェック
3. 非同期処理の型安全性向上
   - Promise型の適切な活用
   - エラーハンドリングの型安全性

【完了基準】
- FrontendDataFlow型の実用的活用が確認できること
- API通信エラーが型レベルで検知できること
- 非同期データフローの型安全性が確保されること

【活用する型定義】
- types/api-types.d.ts の既存API型
- types/html-environment.d.ts のFrontendDataFlow型
- エラーレスポンス型の統一活用

推定作業時間: 1週間
```

---

## 📈 Medium優先度：段階的改善

### Medium-1: VSCode型補完完全復旧

```
@docs/FRONTEND_TYPE_SAFETY_STATUS_REPORT.md に基づき、Medium優先度の「VSCode型補完完全復旧」を実施してください。

【目標】
開発体験の根本的改善とTypeScript機能の完全活用

【作業内容】
1. 型エラーによるIntelliSense阻害要因の特定・解消
2. 型定義参照の最適化確認
3. 実際の開発ワークフローでの型補完動作テスト

【検証方法】
1. 意図的な型エラー挿入→エラー検知確認
2. 関数・変数の自動補完動作確認
3. 型推論の正確性確認

【完了基準】
- VSCodeで適切な型補完が動作すること
- 型エラーによる実際のバグ検知が可能になること
- AI支援（Claude Code等）の提案精度が向上すること

推定作業時間: 3-5日
```

### Medium-2: 状態管理システム完全化

```
@docs/FRONTEND_TYPE_SAFETY_STATUS_REPORT.md に基づき、Medium優先度の「状態管理システム型安全性完全化」を実施してください。

【対象】
- StateManager の状態更新パターン型定義（70%→100%）
- コンポーネント間通信の型安全性向上

【作業内容】
1. StateUpdatePattern型の実用的活用
2. コンポーネント間メッセージング型安全性
3. 状態変更ライフサイクルの型チェック強化

【完了基準】
- 状態更新型安全性が100%達成されること
- StateManager周辺のすべての型エラーが解消されること

推定作業時間: 3-5日
```

---

## 🔧 特殊用途：検証・テスト

### Test-1: 型安全性検証テスト

````
@docs/FRONTEND_TYPE_SAFETY_STATUS_REPORT.md の改善効果を検証するテストを実施してください。

【検証項目】
1. 型エラー数の定量的測定
   - 修正前後の比較
   - ファイル別エラー分布の変化
2. 実用性テスト
   - VSCode補完機能の動作確認
   - 意図的バグの型レベル検知テスト
3. 開発体験評価
   - AI支援精度の変化測定
   - コードレビュー効率の改善確認

【実行方法】
```bash
# 型エラー数測定
npx tsc --noEmit 2>&1 | grep "error" | wc -l

# フロントエンド特化測定
npx tsc --noEmit 2>&1 | grep "src/frontend" | wc -l

# 品質チェック
npm run check
````

【報告形式】改善前後の定量的比較表を作成してください。

```

### Test-2: 段階的品質向上確認

```

現在の作業段階での品質向上効果を確認し、次段階の作業優先度を再評価してください。

【確認手順】

1. 現在の型エラー状況測定
2. 実装済み機能の型安全性評価
3. 残存課題の優先度再分析
4. 次段階推奨作業の提案

【評価基準】

- 型エラー数の変化
- 実用型安全性の向上度
- 開発体験の改善実感
- AI支援精度の変化

この評価に基づいて、継続作業の方向性を調整してください。

```

---

## 📋 作業完了時の確認テンプレート

### 完了確認チェックリスト

```

作業完了後、以下の確認を実施してください：

【必須確認項目】

- □ `npm run check` → エラー・警告の状況確認
- □ `npm run dev:build` → ビルド成功確認
- □ `npm run dev:test` → テスト環境での動作確認
- □ VSCodeでの型補完動作確認

【品質確認項目】

- □ 型エラー数の減少確認
- □ 新規エラーの未発生確認
- □ 既存機能の正常動作確認
- □ パフォーマンス影響の確認

【報告項目】

- 修正したファイル一覧
- 解消した型エラー数
- 残存する課題（あれば）
- 次段階の推奨作業

作業完了の報告とともに、上記確認結果をお知らせください。

```

---

## 💡 使用方法

1. **段階選択**: Critical → High → Medium の順で実施
2. **コピペ使用**: 該当する指示文をそのままAIに送信
3. **カスタマイズ**: 必要に応じて作業範囲を調整
4. **進捗管理**: 完了確認テンプレートで品質確保

**注意**: 各段階の作業完了後、必ず確認テンプレートを使用して品質チェックを実施してください。

> 一度の指示で改修が終わらなかった場合は、なんと伝えると良いでしょうか？
  ⎿  Found 10 new diagnostic issues in 1 file (ctrl-o to expand)

⏺ 一度の指示で改修が終わらなかった場合の効果的な継続指示方法をお答えします：

  🎯 状況別継続指示テンプレート

  パターンA: 部分完了の場合

  前回の作業お疲れさまでした。

  残存課題の継続作業をお願いします：
  - 前回完了: [具体的な完了項目]
  - 今回対象: [残った具体的項目]

  前回の作業内容を引き継いで、残りの[具体的な作業]を完了してください。
  npm run checkの現在の状況から継続してください。

  パターンB: 新しいエラーが発生した場合

  前回の修正により新たな型エラーが発生している可能性があります。

  以下の手順で状況を整理してください：
  1. 現在の型エラー状況を確認（npx tsc --noEmit）
  2. 前回修正の影響で生じた新規エラーを特定
  3. 元の目標と新規課題の両方に対処

  優先順位: 新規エラー解消 → 元の作業継続

  パターンC: 想定より複雑だった場合

  作業が想定より複雑なようですね。

  アプローチを調整しましょう：
  - 最小限の修正で安定化を優先
  - Critical部分のみ先行完了
  - 残りは次段階に分割

  まず[具体的な最小修正]のみ実施し、動作確認後に残りを継続してください。

  📋 効果的な継続指示の要素

  ✅ 必ず含める要素

  1. 前回作業の確認: 「前回の○○は完了していますね」
  2. 現状把握指示: 「まず現在の型エラー状況を確認してください」
  3. 明確な継続範囲: 「今回は残りの○○に焦点を当てて」
  4. 優先順位の再確認: 「まず○○、次に○○の順で」

  ✅ 状況に応じた調整

  【エラー急増の場合】
  「型エラーが増加しているようです。まず前回の修正による影響を最小化し、
  段階的に進めましょう。まず重複定義のみ解消してください。」

  【想定外の複雑さの場合】
  「思ったより複雑ですね。今回は最も影響の大きい○○のみに絞って
  完了させ、残りは別途対応しましょう。」

  【部分的成功の場合】
  「良い進展ですね。この調子で残りの○○も同様に進めてください。
  前回のアプローチを踏襲してください。」

  🚀 実際の継続指示例

  Critical作業の継続例

  12_WebApp_Core.jsの重複定義解消、お疲れさまでした。

  引き続き同ファイルの暗黙any型修正を進めてください：
  - `loadingMessageTimer`変数の型注釈
  - モーダル関数のパラメータ型定義
  - 前回修正した部分は触らずに残りの部分のみ対象

  npm run checkで現在のエラー状況を確認してから作業開始してください。

  High作業の継続例

  イベントハンドラーの一部修正が完了していますね。

  残りのイベント関連機能も同様のパターンで修正してください：
  - 前回と同じアプローチでDOM操作部分
  - types/html-environment.d.tsの型定義を活用
  - 一つずつ確実に進行

  前回の修正品質が良好なので、同様の方針で継続してください。

  ⚠️ 避けるべき継続指示

  ❌ 悪い例

  「うまくいかなかったので違うアプローチで」
  「全体的にやり直して」
  「もっと簡単な方法で」

  ✅ 良い例

  「前回の○○は良好なので、同じ方針で○○の部分も進めて」
  「現在の状況を確認後、残りの具体的な○○を完了して」
  「前回の修正を維持しつつ、新たに発生した○○に対処して」

  💡 継続指示のコツ

  1. 積極的な評価: 「前回の○○は完璧でした」
  2. 具体的な継続範囲: 漠然とした指示を避ける
  3. 状況確認の指示: 必ず現状把握から開始
  4. 段階的アプローチ: 一度に多くを求めない

  継続指示では、AIが前回の作業成果を活かしつつ、明確な次のステップを踏めるよう具体的に導くことが重要
  です。
```
