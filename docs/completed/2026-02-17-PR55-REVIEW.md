# PR #55 レビュー: レガシーデータ取り込み基盤

## 概要

レガシー予約データの取り込み機能を追加する大規模なPR（+5,806行）です。

## HIGH 重要度の指摘

### 1. ハードコードされたスプレッドシートID (L114, L136-137)

本番のGoogle SpreadsheetIDが直接コードに埋め込まれています。`PropertiesService.getScriptProperties()` や設定シートへの移動を検討してください。

### 2. 行単位の削除処理 (L4620-4628)

重複排除時に`deleteRow()`を1行ずつ呼んでおり、GASの実行時間制限に達するリスクがあります。非重複行を`setValues()`で一括書き込みする方式に変更してください。

### 3. 行単位の更新処理 (L4399-4405)

名簿を1行ずつ更新しています。バッチ`setValues()`に変更してください。

### 4. 関数の巨大化

`importLegacyReservations()`(~590行), `syncLegacyApplicationProfilesToRoster()`(~611行) 等、500行超の関数が4つあります。

### 5. 大量のコード重複

警告コレクタ(~8箇所), チャンク書き込み(~6箇所), dryRun/runペア(6ペア以上) が繰り返されています。共通ユーティリティへの抽出を推奨します。

### 6. ファイルサイズ (561行→6,072行)

レガシーインポートは別モジュールに分離すべきです。

### 7. ユニットテスト不可

36個のプライベートヘルパー関数がエクスポートされておらず、個別テスト不可能です。

### 8. 同一シートの繰り返し読み込み

関数チェーンで名簿・予約・スケジュールが2〜4回独立に読み込まれています。

## MEDIUM 重要度の指摘

### 9. 日付変換のタイムゾーンバグ (L376-383)

Excelシリアル日付をUTC経由で変換していますが、Asia/Tokyoで1日ずれる可能性があります。

### 10. 重複したシート名候補 (L125-130)

配列内に完全な重複エントリがあります（コピペミス）。

### 11. duplicateReservationIdStrategyのデフォルト不一致

直接呼び出し('skip') とラッパー経由('regenerate') で異なります。

### 12. 3桁数値の時刻解釈の曖昧さ (L434-445)

`130`が`01:30`と解釈されますが、`13:00`の意図の可能性もあります。

### 13. エラー結果の型が不統一

関数によって`{success:false,...}`, `null` など返り値が異なります。

### 14. マイグレーションコードと永続コードの混在

## LOW 重要度の指摘

### 15. 不正時刻値の無言クランプ

### 16. 警告上限超過時の通知なし

### 17. マジックナンバー: 列22のフォールバック (L5208)

## 他ファイルの変更

- **08_Utilities.js**: `transportation`/`pickup`フィールド追加は適切。既存パターンに一貫。
- **13_WebApp_Views_Dashboard.js**: `mt-4`→`mt-16`は意図的か確認推奨。
- **.gitignore**: `.tmp/`除外は妥当。空行2連続は1行に。

## 総合評価

HIGH: 8件 / MEDIUM: 6件 / LOW: 3件

**良い点**: JSDoc充実、多様な入力対応、dryRunモード、transportation/pickup追加の一貫性 **改善推奨**: モジュール分離、ユニットテスト、バッチ操作化、設定外部化、重複排除
