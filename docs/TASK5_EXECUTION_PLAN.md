### タスク5: HTML生成方法の見直し 作業計画 (最終版)

**目標:** UIコードの可読性と保守性を抜本的に改善するため、HTML生成ロジックをコンポーネントとしてファイルに分離し、宣言的なビュー定義を目指す。

**方針:** 「関心の分離」を徹底する。UIの部品（コンポーネント）は独立したファイルに集約し、ビュー定義ファイル(`13_WebApp_Views.html`)は、それらのコンポーネントを組み合わせて「何を・どの順で表示するか」を記述することに専念させる。既存コンポーネントの利用には固執せず、可読性が最も高まるようにコンポーネントを積極的に新設・再設計する。

**ステップ:**

1. **コンポーネントファイルの分離 (1時間)**
   - **作業:**
     1. `src`ディレクトリに `13_WebApp_Components.html` を新規作成します。
     2. `12_WebApp_Core.html` から既存の `Components` オブジェクトの定義を`13_WebApp_Components.html`へ完全に移動します。
     3. メインの `10_WebApp.html` を編集し、`<script>`タグのインクルード順が `12_WebApp_Core.html` → `13_WebApp_Components.html` → `13_WebApp_Views.html` となるように修正します。
   - **目的:** UI部品の定義を、コアロジックやビュー定義から物理的に分離し、見通しを良くします。

2. **リファクタリング対象の特定 (1時間)**
   - **対象ファイル:** `13_WebApp_Views.html`
   - **作業:** 各`render`関数をレビューし、手書きのHTML文字列で複雑なUIを構築している箇所を特定します。特に、条件分岐やループ処理がHTML構造と密接に絡み合っている部分を優先的なリファクタリング対象とします。

3. **コンポーネントの再設計と実装 (5時間)**
   - **対象ファイル:** `13_WebApp_Components.html`, `13_WebApp_Views.html`
   - **作業:**
     1. ステップ2で特定したUI部品を、意味のある単位でコンポーネント関数として`13_WebApp_Components.html`に新設・実装します。既存のコンポーネントは参考にしつつも、より使いやすく、可読性の高いシグネチャ（引数）で設計します。
        - **例:** 会計フォームのテーブルが複雑であれば、`createAccountingTable(items)`や`createAccountingRow(item)`のような、より抽象度の高いコンポーネントを作成します。
     2. `13_WebApp_Views.html`の`render`関数内を、新しく設計したコンポーネント関数を呼び出すだけのシンプルなコードにリファクタリングします。データ加工のロジックは`render`関数の前半に寄せ、後半はコンポーネント呼び出しに徹するようにします。

4. **動作確認とテスト (2時間)**
   - **作業:** リファクタリングした全てのビューが正しく表示され、フォームの入力やボタンのクリックといったインタラクションが以前と同様に機能することをブラウザで確認します。

**この計画のメリット:**

- **関心の分離:** UI部品(Components)、ビュー定義(Views)、コアロジック(Core)がファイル単位で明確に分離され、コードの理解と修正が容易になります。
- **高い可読性:** ビュー定義ファイルが「どのコンポーネントを呼び出しているか」という宣言的な記述になるため、UIの全体像を素早く把握できます。
- **柔軟性と再利用性:** 既存の実装に縛られずに最適なコンポーネントを設計できるため、将来的な機能追加や変更にも対応しやすくなります。
