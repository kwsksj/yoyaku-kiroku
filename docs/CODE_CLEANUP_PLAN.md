# コードクリーンアップ計画書

## 1. 目的

この計画書は、`COMPREHENSIVE_REFACTORING_PLAN.md` にて定義された大規模なリファクタリングが完了した後に実施する、コードの品質向上を目的としたタスクを定義する。

主に、処理の共通化とヘルパー関数の導入により、コードの重複を削減し、可読性と保守性をさらに高めることを目指す。

## 2. タスクリスト

### タスク1: 共通処理のヘルパー関数化

**背景**: キャッシュからのデータ取得や、特定の条件でのデータフィルタリングは、アプリケーションの様々な箇所で繰り返し行われる。これらのロジックを共通のヘルパー関数として切り出すことで、コードの見通しが良くなり、将来の仕様変更にも強くなる。

#### 1.1. 特定の予約情報を取得するヘルパー関数の作成

- **関数名案**: `getCachedReservationsFor(date, classroom)`
- **役割**: `getCachedData(CACHE_KEYS.ALL_RESERVATIONS)` を呼び出し、取得した全予約データの中から、指定された `日付` と `教室` に合致する予約のみをフィルタリングして返す。
- **メリット**: 定員チェックなどで必要となる「特定日の予約を取得する」というロジックを、この関数に集約できる。

#### 1.2. 特定の生徒情報を取得するヘルパー関数の作成

- **関数名案**: `getCachedStudentById(studentId)`
- **役割**: `getCachedData(CACHE_KEYS.ALL_STUDENTS_BASIC)` を呼び出し、`cache.students[studentId]` のようにして特定の生徒オブジェクトを返す。
- **メリット**: 生徒IDから情報を取得する、という意図が明確になり、コードが読みやすくなる。

### タスク2: 既存コードへのヘルパー関数適用

**背景**: 上記で作成した新しいヘルパー関数を、実際のコードに適用していく。

- **手順**:
  1. プロジェクト全体で `getCachedData(CACHE_KEYS.ALL_RESERVATIONS)` を呼び出している箇所を検索する。
  2. その後の処理が、日付や教室でフィルタリングするロジックであれば、新しい `getCachedReservationsFor()` ヘルパー関数に置き換える。
  3. 同様に、`getCachedData(CACHE_KEYS.ALL_STUDENTS_BASIC)` を呼び出して特定の生徒情報を取得している箇所を、`getCachedStudentById()` に置き換える。

## 3. 実施タイミング

本計画書のタスクは、`COMPREHENSIVE_REFACTORING_PLAN.md` に記載されたフェーズ1〜3の**すべてが完了した後**に着手することを推奨する。

大規模な構造変更が完了した後にコードをクリーンアップすることで、手戻りを防ぎ、効率的に作業を進めることができる。

---

**作成日**: 2025-08-29
